<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="John Pfeiffer" />
        <meta name="copyright" content="John Pfeiffer" />

<meta name="keywords" content=", linux, " />
        <title>Amazon SES on EC2 free tier to search for a kitteh!  · johnpfeiffer
</title>
        <link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="/theme/images/apple-touch-icon-144x144.png" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class=site-name>johnpfeiffer</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="">Home</a></li>
                            <li ><a href="/about-john-pfeiffer">About John Pfeiffer</a></li>
                            <li ><a href="/categories.html">Categories</a></li>
                            <li ><a href="/tags.html">Tags</a></li>
                            <li ><a href="/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="/amazon-ses-on-ec2-free-tier-to-search-for-a-kitteh"> Amazon SES on EC2 free tier to search for a kitteh!  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            <div class="field field-name-body field-type-text-with-summary field-label-hidden">
<div class="field-items">
<div class="field-item even">
Mission: hourly poll of a website to find out if the Kitteh is available
for adoption and immediate email notification if Kitteh is found.

</p>

Estimated time to complete: between 15 minutes and hours (depending on
setting up your EC2 instance, SES service, etc.)

</p>

Skills: Amazon EC2 setup, SSH, centos yum, bash, wget, cronjob

</p>

- - - - - -

</p>

2011-02 Amazon Free tier\*

</p>

If you have an Amazon EC2 instance running (e.g. EC2 Linux Micro
Instance in Free Tier = centos!)  

(And you're not running over the GET/POST upload/download free tier
bandwidths)

</p>

(If you don't know how to setup a quick Amazon Linux Micro Instance in
the free tier  
[http://kittyandbear.net/john/virtualization/amazon-aws-free-tier-linux-w...][]
)

</p>

Sign up for SES (then receive a verification email for your Amazon AWS
Account)  

Account Security Credentials (for AWS access identifiers)  

Use nano or vi to create a file "aws-credentials" (Amazon's sample
below)

</p>

AWSAccessKeyId=022QF06E7MXBSH9DHM  

AWSSecretKey=kWcrlUX5JEDGM/LtmEENI/aVmYvHNif5zB+d9+

</p>

Download the example perl scripts via:
[http://aws.amazon.com/code/Amazon-SES][]  

wget
[http://aws-catalog-download-files.s3.amazonaws.com/AmazonSES-2011-02-02.zip][]

</p>

unzip AmazonSES-2011-02-02.zip  

chmod +x /home/ec2-user/\*.pl

</p>

/home/ec2-user/bin/ses-verify-email-address.pl -k aws-credentials -v
[youreemail@domain.com][]

</p>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - -  

"Can't locate XML/LibXML.pm in @INC (@INC contains:
/usr/local/lib64/perl5  

/usr/local/share/perl5 /usr/local/share/perl5 /usr/lib64/perl5
/usr/share/perl5  

/usr/share/perl5 /usr/lib64/perl5 /usr/share/perl5  

/usr/local/lib64/perl5/site\_perl/5.10.0/x86\_64-linux-thread-multi  

/usr/local/lib/perl5/site\_perl/5.10.0  

/usr/lib64/perl5/vendor\_perl/5.10.0/x86\_64-linux-thread-multi
/usr/lib/perl5/vendor\_perl  

/usr/lib/perl5/site\_perl .) at ./ses-verify-email-address.pl line 26.  

BEGIN failed--compilation aborted at ./ses-verify-email-address.pl line
26."

</p>

THANKS AMAZON! Using their preconfigured Instance means they don't have
all of the Perl packages installed...

</p>

sudo yum install perl-XML-LibXML perl-digest-SHA

</p>

sudo yum provides \*/SHA.pm (tells me what other packages I might have
missed...)

</p>

sudo yum search perl-Digest

</p>

sudo yum install perl-Digest-SHA

</p>

( What a difference a D versus d makes!)  

( sudo yum perl-libxml-perl libxml2-devel perl-IO-Socket-SSL
libxslt-devel ?)  

(debian sudo apt-get install libio-socket-ssl-perl libxml-libxml-perl)  

tail /var/log/maillog for troubleshooting sendmail...

</p>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - -  

/home/ec2-user/bin/ses-verify-email-address.pl -k aws-credentials -v
[youreemail@domain.com][]

</p>

use the email account you gave above for verification and click on the
link...  

You have successfully verified an email address with Amazon Simple Email
Service.

</p>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - -  

\~/amazonses/bin/ses-send-email.pl -k \~/amazonses/bin/aws-credentials
-s "Test AWS" -f [youremail@domain.com][]
[youremail@domain.com][],[secondemail@domain.com][] <
\~/kittysearch/result.txt

</p>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - -  

\#/bin/bash

</p>

wget -O \~/kittysearch/page1.htm
'[http://adopt.hssv.org/search/searchResults.asp?task=search&searchid=&adv...][]'

</p>

wget -O \~/kittysearch/page2.htm
'[http://adopt.hssv.org/search/searchResults.asp?tpage=2&task=search&searc...][]'

</p>

wget -O \~/kittysearch/page3.htm
'[http://adopt.hssv.org/search/searchResults.asp?tpage=3&task=search&searc...][]'

</p>

grep -i "bandit" \~/kittysearch/page1.htm \~/kittysearch/page2.htm
\~/kittysearch/page3.htm \> \~/kittysearch/result.txt

</p>

if [ -s \~/kittysearch/result.txt ] then

</p>

\# must move to the directory to use the SES.pm  

cd \~/amazonses/bin

</p>

./ses-send-email.pl -k \~/amazonses/bin/aws-credentials -s "Test AWS" -f
[myemail@domain.com][]
[myemail@domain.com][],[secondrecipient@domain.com][] <
\~/kittysearch/result.txt

</p>

fi

</p>

\# [http://docs.amazonwebservices.com/ses/latest/DeveloperGuide/][] for
full details about email.pl

</p>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - -  

crontab -e  

(i key to enter input in vi)  

55 \* \* \* \* /home/ec2-user/kittysearch/kittysearch.sh  

(escape key gets : then x to save and quit)

</p>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - -  

Running the script from a different directory or CRON gets the error:
"Can't locate SES.pm in @INC"

</p>

cp /home/ec2-user/amazonses/bin/SES.pm /home/ec2-user/kittysearch

</p>

FIXED! \# must move to the directory in the script using cd first to
have access to SES.pm

</p>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - -

</p>

\*You can send 2,000 messages for free each day when you call Amazon SES
from an Amazon EC2  

instance directly or through AWS Elastic Beanstalk. (Note bandwidth
charges may still apply)

</p>
<p>
</div>

<p></div>
</div>
<div class="field field-name-taxonomy-vocabulary-1 field-type-taxonomy-term-reference field-label-above clearfix"></p>
<h3 id="tags">tags:</h3>
<ul>
<li><a href="http://john-pfeiffer.com/category/tags/linux">Linux</a></li>
<li><a href="http://john-pfeiffer.com/category/tags/programming">Programming</a></li>
</ul>
<p></div>
</p></p>
<div class="highlight"><pre><span class="nl">http:</span><span class="c1">//kittyandbear.net/john/virtualization/amazon-aws-free-tier-linux-web-server.txt</span>
<span class="nl">http:</span><span class="c1">//aws-catalog-download-files.s3.amazonaws.com/AmazonSES-2011-02-02.zip</span>
<span class="nl">http:</span><span class="c1">//adopt.hssv.org/search/searchResults.asp?task=search&amp;searchid=&amp;advanced=&amp;s=adoption&amp;animalType=2%2C15&amp;statusID=3&amp;state=&amp;regionID=&amp;submitbtn=Find+Animals</span>
<span class="nl">http:</span><span class="c1">//adopt.hssv.org/search/searchResults.asp?tpage=2&amp;task=search&amp;searchid=&amp;advanced=&amp;s=&amp;animalType=2,15&amp;statusID=3&amp;state=&amp;regionID=&amp;submitbtn=Find+Animals</span>
<span class="nl">http:</span><span class="c1">//adopt.hssv.org/search/searchResults.asp?tpage=3&amp;task=search&amp;searchid=&amp;advanced=&amp;s=&amp;animalType=2,15&amp;statusID=3&amp;state=&amp;regionID=&amp;submitbtn=Find+Animals</span>
</pre></div>
            <aside>
            <hr/>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="/content/command-line-dos-networking" title="Previous: Command Line DOS Networking">Command Line DOS Networking</a></li>
 
                <li class="next_article"><a href="/time-for-programmers" title="Next: Time for Programmers">Time for Programmers</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2011-02-28T00:07:00">Feb 28, 2011</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#linux-ref">linux</a> 

        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    </body>
</html>