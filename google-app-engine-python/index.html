<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="john pfeiffer" />
        <meta name="copyright" content="john pfeiffer" />

<meta name="keywords" content="programming, google app engine, python, webapp2, programming, " />
        <title>Google App Engine Python  Â· johnpfeiffer
</title>
        <!--link href="https://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css"-->
        <!--link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet"-->
        <link href="https://blog.john-pfeiffer.com/theme/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://blog.john-pfeiffer.com/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://blog.john-pfeiffer.com/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="https://blog.john-pfeiffer.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-144x144.png" />
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3758734-9']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    </head>
    <body>
	<div id="content-sans-footer">
        <div class="dropdown-backdrop">

			<div class="navbar navbar-static-top">
				<div class="navbar-inner">
					<div class="container">
						<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</a>
						<a class="brand" href="https://blog.john-pfeiffer.com/"><span class=site-name>johnpfeiffer</span></a>
						<div class="nav-collapse collapse">
							<ul class="nav pull-right top-menu">
								<li ><a href="https://blog.john-pfeiffer.com">Home</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/john-likes/">John Likes</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/categories.html">Categories</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/tags.html">Tags</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/archives.html">Archives</a></li>
								<li><form class="navbar-search" action="https://blog.john-pfeiffer.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span1"></div>
				<div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="https://blog.john-pfeiffer.com/google-app-engine-python/"> Google App Engine Python  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#setting-up">Setting Up</a><ul>
<li><a href="#a-first-helloworldappyaml">A first helloworld/app.yaml</a><ul>
<li><a href="#a-revised-yaml-file">A revised yaml file</a></li>
</ul>
</li>
<li><a href="#helloworldmainpy">helloworld/main.py</a></li>
<li><a href="#view-the-app-on-your-local-machine">View the app on your local machine</a></li>
<li><a href="#upload-the-app-to-google-app-engine">Upload the app to Google App Engine</a></li>
</ul>
</li>
<li><a href="#download-an-existing-application-from-google-app-engine">Download an existing application from Google App Engine</a></li>
<li><a href="#updating-the-application-for-routes-and-post-requests">Updating the Application for routes and POST requests</a><ul>
<li><a href="#appyaml">app.yaml</a></li>
<li><a href="#mainpy">main.py</a></li>
<li><a href="#update-the-google-app-engine-application-code-that-is-running-in-the-cloud">Update the google app engine application code that is running in the cloud</a></li>
</ul>
</li>
<li><a href="#a-simple-single-file-crud-app-using-the-google-appengine-database">A simple single file CRUD app using the Google AppEngine Database</a></li>
<li><a href="#usrbinenv-python">!/usr/bin/env python</a></li>
<li><a href="#2013-01-20-johnpfeiffer">2013-01-20 johnpfeiffer</a></li>
<li><a href="#todo-navigation-bar">TODO: navigation bar</a></li>
<li><a href="#todo-use-template-system">TODO: use template system</a></li>
<li><a href="#todo-use-template-system_1">TODO: use template system</a></li>
<li><a href="#q-dbquery-node-keys_only-is-faster-and-cheaper-than-retrieving-the-entities">q = db.Query( Node )    # keys_only is faster and cheaper than retrieving the entities</a></li>
<li><a href="#qfilter-id-id">q.filter( "id=" , id )</a></li>
<li><a href="#dbdelete">db.delete( )</a></li>
<li><a href="#node_key-key">node_key =          # key</a></li>
<li><a href="#url-handler-below-">url handler below -----------------------------</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">

            
<h2 id="setting-up">Setting Up</h2>
<p>Sign up for Google App Engine (gmail + SMS verification)</p>
<p>"Google App Engine (often referred to as GAE or simply App Engine, and also used by the acronym GAE/J) is a platform as a service (PaaS) cloud computing platform for developing and hosting web applications in Google-managed data centers."</p>
<p>The Admin Dashboard is linked to your Google profile <a href="https://console.cloud.google.com">https://console.cloud.google.com</a></p>
<p>Login and create an Application (e.g. named john-pfeiffer reachable at <a href="http://john-pfeiffer.appspot.com">http://john-pfeiffer.appspot.com</a>)</p>
<p>Download and extract the SDK (e.g. gae-python.zip)</p>
<div class="highlight"><pre><span></span>cd google_appengine
cp -a new_project_template helloworld
</pre></div>
<blockquote>
<p>Inside is the minimum file structucture required to have an application</p>
</blockquote>
<ul>
<li>app.yaml is the configuration file</li>
<li>index.yaml is how to override configuration for database indices</li>
<li>favicon.ico is the icon that appears in the browser tab or bookmark <a href="https://en.wikipedia.org/wiki/Favicon">https://en.wikipedia.org/wiki/Favicon</a></li>
<li>main.py is the entrypoint for your application</li>
</ul>
<hr/>
<h3 id="a-first-helloworldappyaml">A first helloworld/app.yaml</h3>
<div class="highlight"><pre><span></span><span class="n">application</span><span class="o">:</span> <span class="n">john</span><span class="o">-</span><span class="n">pfeiffer</span>
<span class="n">version</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">runtime</span><span class="o">:</span> <span class="n">python27</span>
<span class="n">api_version</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">threadsafe</span><span class="o">:</span> <span class="n">yes</span>

<span class="n">handlers</span><span class="o">:</span>
<span class="o">-</span> <span class="n">url</span><span class="o">:</span> <span class="o">/</span><span class="n">favicon</span><span class="o">\.</span><span class="n">ico</span>
  <span class="n">static_files</span><span class="o">:</span> <span class="n">favicon</span><span class="o">.</span><span class="na">ico</span>
  <span class="n">upload</span><span class="o">:</span> <span class="n">favicon</span><span class="o">\.</span><span class="n">ico</span>

<span class="o">-</span> <span class="n">url</span><span class="o">:</span> <span class="o">.*</span>
  <span class="n">script</span><span class="o">:</span> <span class="n">main</span><span class="o">.</span><span class="na">app</span>

<span class="n">libraries</span><span class="o">:</span>
<span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">webapp2</span>
  <span class="n">version</span><span class="o">:</span> <span class="s2">"2.5.2"</span>
</pre></div>
<blockquote>
<p>yaml files are indentation based</p>
</blockquote>
<h4 id="a-revised-yaml-file">A revised yaml file</h4>
<div class="highlight"><pre><span></span><span class="n">runtime</span><span class="o">:</span> <span class="n">python27</span>
<span class="n">api_version</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">threadsafe</span><span class="o">:</span> <span class="n">yes</span>

<span class="n">handlers</span><span class="o">:</span>
<span class="o">-</span> <span class="n">url</span><span class="o">:</span> <span class="o">.*</span>
  <span class="n">script</span><span class="o">:</span> <span class="n">main</span><span class="o">.</span><span class="na">app</span>

<span class="n">libraries</span><span class="o">:</span>
<span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">webapp2</span>
  <span class="n">version</span><span class="o">:</span> <span class="s2">"2.5.2"</span>
</pre></div>
<blockquote>
<p>the newer requirement is to NOT include the application name or version, apparently that is passed as a CLI parameter </p>
</blockquote>
<ul>
<li><a href="https://cloud.google.com/appengine/docs/standard/python/getting-started/hosting-a-static-website#creating_the_appyaml_file">https://cloud.google.com/appengine/docs/standard/python/getting-started/hosting-a-static-website#creating_the_appyaml_file</a></li>
<li><a href="https://cloud.google.com/sdk/gcloud/reference/config/set">https://cloud.google.com/sdk/gcloud/reference/config/set</a></li>
</ul>
<h3 id="helloworldmainpy">helloworld/main.py</h3>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">webapp2</span>

<span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'Hi World!'</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">webapp2</span><span class="o">.</span><span class="n">WSGIApplication</span><span class="p">([(</span><span class="s1">'/'</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">)],</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
<h3 id="view-the-app-on-your-local-machine">View the app on your local machine</h3>
<div class="highlight"><pre><span></span>cd google_appengine
./dev_appserver.py ./helloworld

    INFO 2012-12-27 04:20:20,399 dev_appserver_multiprocess.py:655]
    Running application dev\~john-pfeiffer on port 8080:
    http://localhost:8080

    INFO 2012-12-27 04:20:20,399 dev_appserver_multiprocess.py:657] Admin console is available at: http://localhost:8080/\_ah/admin
</pre></div>
<h3 id="upload-the-app-to-google-app-engine">Upload the app to Google App Engine</h3>
<div class="highlight"><pre><span></span><span class="o">./</span><span class="nt">appcfg</span><span class="p">.</span><span class="nc">py</span> <span class="nt">update</span> <span class="nt">helloworld</span><span class="o">/</span>

    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Host</span><span class="o">:</span> <span class="nt">appengine</span><span class="p">.</span><span class="nc">google</span><span class="p">.</span><span class="nc">com</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Application</span><span class="o">:</span> <span class="nt">john-pfeiffer</span><span class="o">;</span> <span class="nt">version</span><span class="o">:</span> <span class="nt">1</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Starting</span> <span class="nt">update</span> <span class="nt">of</span> <span class="nt">app</span><span class="o">:</span> <span class="nt">john-pfeiffer</span><span class="o">,</span> <span class="nt">version</span><span class="o">:</span> <span class="nt">1</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Getting</span> <span class="nt">current</span> <span class="nt">resource</span> <span class="nt">limits</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Scanning</span> <span class="nt">files</span> <span class="nt">on</span> <span class="nt">local</span> <span class="nt">disk</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Cloning</span> <span class="nt">1</span> <span class="nt">static</span> <span class="nt">file</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Cloning</span> <span class="nt">3</span> <span class="nt">application</span> <span class="nt">files</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Uploading</span> <span class="nt">1</span> <span class="nt">files</span> <span class="nt">and</span> <span class="nt">blobs</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Uploaded</span> <span class="nt">1</span> <span class="nt">files</span> <span class="nt">and</span> <span class="nt">blobs</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Compilation</span> <span class="nt">starting</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Compilation</span> <span class="nt">completed</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">44</span> <span class="nt">PM</span> <span class="nt">Starting</span> <span class="nt">deployment</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">45</span> <span class="nt">PM</span> <span class="nt">Checking</span> <span class="nt">if</span> <span class="nt">deployment</span> <span class="nt">succeeded</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">45</span> <span class="nt">PM</span> <span class="nt">Will</span> <span class="nt">check</span> <span class="nt">again</span> <span class="nt">in</span> <span class="nt">1</span> <span class="nt">seconds</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">45</span> <span class="nt">PM</span> <span class="nt">Checking</span> <span class="nt">if</span> <span class="nt">deployment</span> <span class="nt">succeeded</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">45</span> <span class="nt">PM</span> <span class="nt">Will</span> <span class="nt">check</span> <span class="nt">again</span> <span class="nt">in</span> <span class="nt">2</span> <span class="nt">seconds</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">45</span> <span class="nt">PM</span> <span class="nt">Checking</span> <span class="nt">if</span> <span class="nt">deployment</span> <span class="nt">succeeded</span><span class="o">.</span>
    <span class="nt">07</span><span class="p">:</span><span class="nd">45</span> <span class="nt">PM</span> <span class="nt">Deployment</span> <span class="nt">successful</span><span class="o">.</span>
</pre></div>
<p>Verify with <code>curl http://john-pfeiffer.appspot.com</code></p>
<h2 id="download-an-existing-application-from-google-app-engine">Download an existing application from Google App Engine</h2>
<div class="highlight"><pre><span></span>mkdir -p /tmp/myapp
appcfg.py download_app -A john-pfeiffer /tmp/myapp
</pre></div>
<blockquote>
<p>This will use OAuth 2 to open a browser/give you a link where you can confirm the action
Once confirmed it will download the latest version off your application code and files
This is independent of and not a replacement for version control!</p>
</blockquote>
<h2 id="updating-the-application-for-routes-and-post-requests">Updating the Application for routes and POST requests</h2>
<p>It is easy to use the MVC pattern while inheriting from the framework <a href="https://webapp-improved.appspot.com/guide/handlers.html">https://webapp-improved.appspot.com/guide/handlers.html</a></p>
<h3 id="appyaml">app.yaml</h3>
<blockquote>
<p>Note that the version has to be explicitly updated in order to deploy something new</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">application</span><span class="o">:</span> <span class="n">john</span><span class="o">-</span><span class="n">pfeiffer</span>
<span class="n">version</span><span class="o">:</span> <span class="mi">6</span>
<span class="n">runtime</span><span class="o">:</span> <span class="n">python27</span>
<span class="n">api_version</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">threadsafe</span><span class="o">:</span> <span class="n">yes</span>

<span class="n">handlers</span><span class="o">:</span>
<span class="o">-</span> <span class="n">url</span><span class="o">:</span> <span class="o">/</span><span class="n">favicon</span><span class="o">.</span><span class="na">ico</span>
  <span class="n">static_files</span><span class="o">:</span> <span class="n">favicon</span><span class="o">.</span><span class="na">ico</span>
  <span class="n">upload</span><span class="o">:</span> <span class="n">favicon</span><span class="o">.</span><span class="na">ico</span>

<span class="o">-</span> <span class="n">url</span><span class="o">:</span> <span class="o">/.*</span>
  <span class="n">script</span><span class="o">:</span> <span class="n">main</span><span class="o">.</span><span class="na">app</span>

<span class="n">libraries</span><span class="o">:</span>
<span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">webapp2</span>
  <span class="n">version</span><span class="o">:</span> <span class="s2">"2.5.2"</span>
</pre></div>
<h3 id="mainpy">main.py</h3>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">webapp2</span>

<span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'hello John Pfeiffer!'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">PageOne</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">            PageOne</span>
<span class="s2">        """</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">PageTwo</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'PageTwo'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">get_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span>
        <span class="n">post_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">get_values</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post_values</span><span class="p">))</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">webapp2</span><span class="o">.</span><span class="n">WSGIApplication</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">'/page-one'</span><span class="p">,</span> <span class="n">PageOne</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">'/page-two'</span><span class="p">,</span> <span class="n">PageTwo</span><span class="p">)</span>
    <span class="p">],</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">run_wsgi_app</span><span class="p">(</span><span class="n">application</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
<h3 id="update-the-google-app-engine-application-code-that-is-running-in-the-cloud">Update the google app engine application code that is running in the cloud</h3>
<div class="highlight"><pre><span></span>./appcfg.py update john-pfeiffer
</pre></div>
<blockquote>
<p>update does not publish the new version yet</p>
</blockquote>
<div class="highlight"><pre><span></span>./appcfg.py set_default_version john-pfeiffer
</pre></div>
<blockquote>
<p>or you can use the WebUI dashboard to change the default or delete a Version for an Application Instance</p>
</blockquote>
<p><a href="https://cloud.google.com/appengine/docs/python/config/appref">https://cloud.google.com/appengine/docs/python/config/appref</a></p>
<hr/>
<h2 id="a-simple-single-file-crud-app-using-the-google-appengine-database">A simple single file CRUD app using the Google AppEngine Database</h2>
<p>Google AppEngine applications can leverage the platforms NoSQL database <a href="https://cloud.google.com/appengine/docs/python/datastore/">https://cloud.google.com/appengine/docs/python/datastore/</a></p>
<p>The example application below also shows how to override the default 404 and 500 errors with custom jinja2 templates which would require installing the jinja2 dependency and an extra subdirectory named templates with the HTML</p>
<ul>
<li><a href="https://blog.john-pfeiffer.com/jinja2-a-web-html-template-layout-for-everyone/">https://blog.john-pfeiffer.com/jinja2-a-web-html-template-layout-for-everyone/</a></li>
<li>
<p><a href="https://cloud.google.com/appengine/docs/python/ndb/">https://cloud.google.com/appengine/docs/python/ndb/</a> has improved and deprecated the DB Datastore library used below</p>
<p>:::python</p>
<h1 id="usrbinenv-python">!/usr/bin/env python</h1>
<h1 id="2013-01-20-johnpfeiffer">2013-01-20 johnpfeiffer</h1>
<p>import os
import logging
import traceback
import cgi
import datetime
import webapp2
import jinja2</p>
<p>from google.appengine.ext import db</p>
<p>jinja_environment = jinja2.Environment( loader=jinja2.FileSystemLoader( os.path.dirname( os.path.dirname( <strong>file</strong> ) ) ) )        </p>
<p>class Node( db.Model ):
    id = db.StringProperty()
    name = db.StringProperty()
    parent_id = db.StringProperty()
    date = db.DateTimeProperty( auto_now_add = True )</p>
<h1 id="todo-navigation-bar">TODO: navigation bar</h1>
<p>class MainPage( webapp2.RequestHandler ):
  def get( self ):
    self.response.out.write( '<html><body>' )
    self.response.out.write( """Welcome <br/></body></html></p>
<div class="highlight"><pre><span></span>     <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/listnodes"</span> <span class="na">method=</span><span class="s">"get"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"List Nodes"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;/form&gt;</span>
     <span class="nt">&lt;br/&gt;</span>
     <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/createnodeform"</span> <span class="na">method=</span><span class="s">"get"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Create Node"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;/form&gt;</span>
     <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/deletenode"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;label&gt;</span>id<span class="nt">&lt;/label&gt;&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"id"</span> <span class="na">name=</span><span class="s">"id"</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Delete Node"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;/form&gt;</span>

     """
)
self.response.out.write( "<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>" )
</pre></div>
<p>class ListNodes( webapp2.RequestHandler ):
  def get( self ):
    self.response.out.write( '<html><body>' )
    self.response.out.write( 'Welcome <br/>' )
    q = db.Query( Node )
    q.order( "name" )
    q.fetch( 100 )
    self.response.out.write( "%s , %s , %s ( %s )<br/>" % ( "name" , "id" , "parent_id" , "created" ) )
    for node in q :
        self.response.out.write( "%s , %s , %s ( %s )<br/>" % ( node.name , node.id , node.parent , node.date ) )</body></html></p>
<div class="highlight"><pre><span></span>self.response.out.write( "<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>" )
</pre></div>
<h1 id="todo-use-template-system">TODO: use template system</h1>
<p>class CreateNode( webapp2.RequestHandler ):
  def get( self ):
    self.response.out.write( '<html><body>' )
    self.response.write( 'Create uses POST' )
    self.response.out.write( "</body></html>" )</p>
<p>def post( self ):
    self.response.out.write( '<html><body>' )
    post_values = self.request.POST</body></html></p>
<div class="highlight"><pre><span></span># todo extract to helper for input validation and sanitization
name = post_values[ "nodename" ]
id = post_values[ "id" ]
parent_id = post_values[ "parentid" ]

if( name == None or id == None or parent_id == None ):
    self.response.out.write( 'ERROR: DEBUG:' , post_values )
else:
    node = Node()
    node.name = name
    node.id = id
    node.parent_id = parent_id

    node.put()
    self.response.out.write( 'successfully created: ' + name )
    self.response.out.write( """
     <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/listnodes"</span> <span class="na">method=</span><span class="s">"get"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"List Nodes"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;/form&gt;</span>
    """
    )

self.response.out.write( "<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>" )
</pre></div>
<p>class CreateNodeForm( webapp2.RequestHandler ):
    def get( self ):
        self.response.out.write( '<html><body>' )
        self.response.out.write( """
         <form action="/createnode" method="post">
<table>
<tr><td><label>node name</label></td><td><input id="nodename" name="nodename" type="text"/></td></tr>
<tr><td><label>id</label></td><td><input id="id" name="id" type="text"/></td></tr>
<tr><td><label>parent id</label></td><td><input id="parentid" name="parentid" type="text"/></td></tr>
<tr><td></td><td><input type="submit"/></td></tr>
</table>
</form>
        """ )
        self.response.out.write( "</body></html>" )</p>
<h1 id="todo-use-template-system_1">TODO: use template system</h1>
<p>class DeleteNode( webapp2.RequestHandler ):
  def get( self ):
    self.response.out.write( '<html><body>' )
    self.response.write( 'Delete uses POST' )
    self.response.out.write( "</body></html>" )</p>
<p>def post( self ):
    self.response.out.write( '<html><body>' )
    post_values = self.request.POST</body></html></p>
<div class="highlight"><pre><span></span># todo extract to helper for input validation and sanitization
id = post_values[ "id" ]
</pre></div>
<h1 id="q-dbquery-node-keys_only-is-faster-and-cheaper-than-retrieving-the-entities">q = db.Query( Node )    # keys_only is faster and cheaper than retrieving the entities</h1>
<h1 id="qfilter-id-id">q.filter( "id=" , id )</h1>
<div class="highlight"><pre><span></span>q = Node.all( keys_only = True ).filter( "id=", id )
node_to_delete = q.run()
</pre></div>
<h1 id="dbdelete">db.delete( )</h1>
<h1 id="node_key-key">node_key =          # <strong>key</strong></h1>
<div class="highlight"><pre><span></span>self.response.out.write( "%s , %s , %s ( %s )<span class="nt">&lt;br/&gt;</span>" % ( "name" , id , "parent_id" , node_to_delete ) )

self.response.out.write( "<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>" )
</pre></div>
<h1 id="url-handler-below-">url handler below -----------------------------</h1>
<p>app = webapp2.WSGIApplication( [
  ( '/', MainPage ),
  ( '/listnodes' , ListNodes ),
  ( '/createnode' , CreateNode ),
  ( '/createnodeform' , CreateNodeForm ),
  ( '/deletenode' , DeleteNode )
], debug = True )</p>
<p>def handle_404 (request , response , exception) :
    template_dictionary = { 'title' : 'ERROR 404' , 'body_content' : exception.status }
    template = jinja_environment.get_template ( 'templates/error.html' )
    response.write ( template.render ( template_dictionary ) )
    response.set_status ( exception.status_int )</p>
<p>def handle_500 (request , response , exception) :
    logging.error ( traceback.print_exc ( ) )
    logging.error ( exception )
    template_dictionary = { 'title' : 'Meow' , 'body_content' : 'Meow.  Meow meow meow, meow meow.' }
    template = jinja_environment.get_template ( 'templates/error.html' )
    response.write ( template.render ( template_dictionary ) )
    response.set_status ( 500 )</p>
<p>app.error_handlers [ 404 ] = handle_404
app.error_handlers [ 500 ] = handle_500</p>
</li>
</ul>
            <aside>
            <hr/>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">Â« <a href="https://blog.john-pfeiffer.com/server-operations-cloud-versus-build-your-own/" title="Previous: Server Operations: Cloud versus Build Your Own">Server Operations: Cloud versus Build Your Own</a></li>
 
                <li class="next_article"><a href="https://blog.john-pfeiffer.com/fix-byobu-infinite-scroll-bug-on-ubuntu-1204-precise-pangolin/" title="Next: Fix Byobu infinite scroll bug on Ubuntu 12.04 Precise Pangolin">Fix Byobu infinite scroll bug on Ubuntu 12.04 Precise Pangolin</a> Â»</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2013-01-26T15:01:00-08:00">Jan 26, 2013</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#programming-ref">programming</a> 
            <h4>~1015 words</h4>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#google-app-engine-ref">google app engine
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#programming-ref">programming
                    <span>7</span>
</a></li>
                <li><a href="/tags.html#python-ref">python
                    <span>10</span>
</a></li>
                <li><a href="/tags.html#webapp2-ref">webapp2
                    <span>2</span>
</a></li>
            </ul>

        </div>
        </section>
</div>
</article>
				</div>
				<div class="span1"></div>
			</div>
		</div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
    </ul>
</div>
</footer>            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    </body>
</html>