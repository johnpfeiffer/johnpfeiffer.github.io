<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="john pfeiffer" />
        <meta name="copyright" content="john pfeiffer" />

<meta name="keywords" content="docker, containers, virtualization, " />
        <title>Docker Intro install run and port forward  Â· johnpfeiffer
</title>
        <!--link href="https://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css"-->
        <!--link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet"-->
        <link href="https://blog.john-pfeiffer.com/theme/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://blog.john-pfeiffer.com/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://blog.john-pfeiffer.com/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="https://blog.john-pfeiffer.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-144x144.png" />
    </head>
    <body>
	<div id="content-sans-footer">
        <div class="dropdown-backdrop">

			<div class="navbar navbar-static-top">
				<div class="navbar-inner">
					<div class="container">
						<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</a>
						<a class="brand" href="https://blog.john-pfeiffer.com/"><span class=site-name>johnpfeiffer</span></a>
						<div class="nav-collapse collapse">
							<ul class="nav pull-right top-menu">
								<li ><a href="https://blog.john-pfeiffer.com">Home</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/john-likes/">John Likes</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/categories.html">Categories</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/tags.html">Tags</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/archives.html">Archives</a></li>
								<li><form class="navbar-search" action="https://blog.john-pfeiffer.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span1"></div>
				<div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="https://blog.john-pfeiffer.com/docker-intro-install-run-and-port-forward/"> Docker Intro install run and port forward  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#install-docker">Install Docker</a><ul>
<li><a href="#installing-on-mac-or-windows">Installing on Mac or Windows</a></li>
<li><a href="#custom-docker0-ip-range">Custom docker0 ip range</a></li>
</ul>
</li>
<li><a href="#quick-start-summary">Quick Start Summary</a></li>
<li><a href="#download-a-docker-image">Download a docker image</a><ul>
<li><a href="#remove-a-docker-image">Remove a docker image</a></li>
<li><a href="#docker-info">Docker info</a></li>
</ul>
</li>
<li><a href="#controlling-containers">Controlling Containers</a><ul>
<li><a href="#starting-a-container-from-an-image">Starting a container from an image</a><ul>
<li><a href="#create-a-container">Create a container</a></li>
<li><a href="#start-resume-a-container">Start (resume) a container</a></li>
<li><a href="#attaching-to-a-running-container">Attaching to a running container</a></li>
<li><a href="#running-a-container-with-admin-privileges">Running a container with admin privileges</a></li>
</ul>
</li>
<li><a href="#stopping-a-container">Stopping a container</a></li>
<li><a href="#copying-a-file-out-of-a-container">Copying a file out of a container</a></li>
<li><a href="#deleting-aka-removing-a-container">Deleting aka removing a container</a></li>
</ul>
</li>
<li><a href="#dockerfile-to-automate-building-an-image">Dockerfile to automate building an image</a></li>
<li><a href="#add-a-port-to-a-container">Add a port to a container</a></li>
<li><a href="#logs-from-the-containers">Logs from the containers</a></li>
<li><a href="#host-data-with-a-docker-container">Host data with a Docker Container</a></li>
<li><a href="#managing-or-limiting-the-resources-available-to-a-container">Managing or limiting the resources available to a Container</a></li>
<li><a href="#using-docker-for-a-gui-application">Using Docker for a GUI application</a></li>
<li><a href="#saving-a-docker-container-as-a-new-image">Saving a docker container as a new image</a><ul>
<li><a href="#docker-commit-for-a-container-ubuntutrusty-with-git">docker commit for a container: ubuntu:trusty with git</a></li>
</ul>
</li>
<li><a href="#misc">Misc</a><ul>
<li><a href="#python-and-pelican-static-site-generator-on-docker-ubuntu1404">Python and Pelican static site generator on docker ubuntu:14.04</a></li>
</ul>
</li>
<li><a href="#docker-pre-built-images-from-the-registry">Docker pre built Images from the Registry</a><ul>
<li><a href="#redis">Redis</a></li>
</ul>
</li>
<li><a href="#docker-compose">Docker Compose</a><ul>
<li><a href="#apppy">app.py</a></li>
<li><a href="#requirementstxt">requirements.txt</a></li>
<li><a href="#dockerfile">Dockerfile</a></li>
<li><a href="#docker-composeyml">docker-compose.yml</a></li>
<li><a href="#docker-compose-up">docker-compose up</a></li>
</ul>
</li>
<li><a href="#troubleshooting">Troubleshooting</a><ul>
<li><a href="#building-images-with-dockerfile">Building images with Dockerfile</a></li>
<li><a href="#discovering-an-image-parent-from-history">Discovering an Image Parent from History</a></li>
</ul>
</li>
<li><a href="#more-info">More Info</a><ul>
<li><a href="#docker-api-and-the-docker-hub-public-registry">Docker API and the Docker Hub Public Registry</a><ul>
<li><a href="#docker-engine-internal-api">Docker Engine internal API</a></li>
</ul>
</li>
<li><a href="#private-docker-registry">Private Docker Registry</a><ul>
<li><a href="#login-to-a-private-docker-registry">Login to a private docker registry</a></li>
<li><a href="#private-registry-basics-via-the-browser">private registry basics via the browser</a></li>
<li><a href="#searching-a-private-docker-registry">Searching a private docker registry</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">

            <p>Docker is a union file system based layer system (previously leveraging linux lxc containers) for ultra lightweight virtualization/compartmentalization.</p>
<p>Much like AWS cloud servers (api based dynamic deployment that should be tolerant of node failure) and automated deployment/configuration infrastructure (chef or puppet such that cloud servers are created idempotent, remotely and automatically managed at scale), Docker requires a change of mindset.</p>
<p>Docker encourages design of modular, deterministic and defined, single purpose components that are easy to compose into larger services.</p>
<p>As any tool, using it for managing complexity and packaging can be very helpful but it does expose other potential issues (composability, orchestration, security).</p>

<ul>
<li><strong>Images</strong> are the initial templates, each image has a unique ID <a href="https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/#content-addressable-storage">https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/#content-addressable-storage</a></li>
<li><strong>Containers</strong> are the running virtual machines, each container has a unique ID  <a href="https://en.wikipedia.org/wiki/Operating-system-level_virtualization">https://en.wikipedia.org/wiki/Operating-system-level_virtualization</a></li>
<li><em>From now on it is assumed you use <strong>sudo</strong> before any docker command!</em></li>
</ul>
<hr/>
<h2 id="install-docker">Install Docker</h2>
<p><a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/">https://docs.docker.com/engine/installation/linux/ubuntulinux/</a></p>
<ol>
<li><code>apt-key adv --keyserver hkp://pgp.mit.edu:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</code></li>
<li><code>sudo sh -c "echo 'deb https://apt.dockerproject.org/repo ubuntu-trusty main' &gt; /etc/apt/sources.list.d/docker.list"</code></li>
<li><code>sudo apt-get update</code></li>
<li><code>apt-get install linux-image-extra-$(uname -r)</code></li>
<li><code>apt-get install docker-engine</code></li>
<li><code>service docker status</code></li>
<li><code>docker info</code></li>
</ol>
<blockquote>
<p>Make sure it lists /var/lib/docker/aufs</p>
<p>OPTIONAL STEP IF YOU HAD AN OLD DOCKER INSTALLATION
<code>apt-get purge lxc-docker*</code></p>
</blockquote>
<h3 id="installing-on-mac-or-windows">Installing on Mac or Windows</h3>
<p><a href="https://www.docker.com/docker-toolbox">https://www.docker.com/docker-toolbox</a></p>
<h3 id="custom-docker0-ip-range">Custom docker0 ip range</h3>
<blockquote>
<p>Fixing the Docker Bridge docker0 taking a huge 172.17.0.1/16 address space...</p>
</blockquote>
<p>Private IP address space is not normally a thing to worry about, unless someone does something silly and grabs 65,534 addresses (stare) (docker)</p>
<p>Because the default docker0 bridge seems to cater to organizations that want to run thousands of containers simultaneously local developers need to do the following fix:</p>
<ol>
<li><code>apt-get install bridge-utils</code></li>
<li><code>service docker stop</code></li>
<li><code>ip link set docker0 down</code></li>
<li><code>brctl delbr docker0</code></li>
<li><code>docker daemon --bip=192.168.239.1/24</code></li>
<li><code>ifconfig</code></li>
</ol>
<blockquote>
<p>Docker will be running interactively so you can see all the fun log messages</p>
<p>You should see docker0 "inet addr:192.168.239.1  Bcast:0.0.0.0  Mask:255.255.255.0"</p>
</blockquote>
<p><em>Assuming you do not have some other purpose for the 192.168.239 range in which case you can change it to something else</em></p>
<p>To permanently have this custom ip range configuration for docker (assuming you have done the steps above):</p>
<ol>
<li>Control + C to quit the previously interactive docker daemon</li>
<li><code>vi /etc/default/docker</code></li>
<li><code>DOCKER_OPTS="--bip=192.168.239.1/24"</code></li>
<li><code>service docker start</code></li>
<li><code>ifconfig</code></li>
</ol>
<blockquote>
<p>You should see docker0 "inet addr:192.168.239.1  Bcast:0.0.0.0  Mask:255.255.255.0"</p>
</blockquote>
<p>More docs to further troubleshoot the docker0 bridge...</p>
<ul>
<li><a href="https://docs.docker.com/engine/userguide/networking/default_network/custom-docker0/">https://docs.docker.com/engine/userguide/networking/default_network/custom-docker0/</a></li>
<li><a href="https://docs.docker.com/engine/admin/systemd/">https://docs.docker.com/engine/admin/systemd/</a></li>
</ul>
<hr/>
<h2 id="quick-start-summary">Quick Start Summary</h2>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="c1">--rm busybox /bin/sh -c "echo 'hi'"</span>
<span class="n">hi</span>

<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="c1">--rm -e MYVAR=123 busybox env</span>
</pre></div>
<blockquote>
<p>"run" will pull the image from Docker Hub by default, e injects an environment variable, overrides the Docker Image CMD with "env"</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="c1">--rm --entrypoint=/bin/sh python:latest</span>
</pre></div>
<ul>
<li>run the docker container (from the latest public python image) and start the shell prompt instead of the python interpreter</li>
<li>the entrypoint parameter overrides the Docker Image (in case they do not provide a helpfully overridable CMD)</li>
<li><a href="https://docs.docker.com/engine/reference/builder/#entrypoint">https://docs.docker.com/engine/reference/builder/#entrypoint</a></li>
</ul>
<hr/>
<h2 id="download-a-docker-image">Download a docker image</h2>
<p>Official Images are he easiest to experiment with: <a href="https://hub.docker.com/explore/">https://hub.docker.com/explore/</a></p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">pull</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">trusty</span>
</pre></div>
<blockquote>
<p>(<strong>grabs the latest, i.e. 14.04.1</strong>) or use a different tag to download a more specific version <code>sudo docker pull ubuntu:12.04.3</code></p>
</blockquote>
<p><strong>CRITICAL WARNING!</strong> use the colon and a specific version! downloading all of the ubuntu images by accident sucks =(</p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">pull</span> <span class="n">redis</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
<blockquote>
<p>choose the latest for just messing around but...
ALWAYS use a specific version to avoid having your dependencies change unexpectedly</p>
</blockquote>
<p>Finding what versions of images (tags) you can pull requires using either the UI or the API:</p>
<ul>
<li><a href="https://hub.docker.com/r/library/redis/tags/">https://hub.docker.com/r/library/redis/tags/</a></li>
<li><code>docker pull redis:3</code></li>
<li><code>docker pull redis:2.8</code></li>
<li><code>docker pull redis:2.6</code></li>
</ul>
<blockquote>
<p>Many of the tags are synonyms/symlinks, so latest is the same as 3 is the same as 3.0</p>
</blockquote>
<h3 id="remove-a-docker-image">Remove a docker image</h3>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">rmi</span> <span class="n">redis</span>

<span class="n">docker</span> <span class="n">rmi</span> <span class="o">-</span><span class="n">f</span> <span class="err">$</span><span class="p">(</span><span class="n">docker</span> <span class="n">images</span> <span class="c1">--all --quiet | grep -v 5506de2b643b)</span>
</pre></div>
<blockquote>
<p>remove ALL images except one by taking the output (quiet means only image ids), excluding a specific one, and then force removing the images (by id)</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">images</span> <span class="c1">--quiet --filter "dangling=true" | xargs docker rmi</span>
</pre></div>
<blockquote>
<p>remove all images that do not have a tag and are not a parent of a tagged image</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">rmi</span> <span class="o">-</span><span class="n">f</span> <span class="err">$</span><span class="p">(</span><span class="n">docker</span> <span class="n">images</span> <span class="c1">--all --quiet)</span>
</pre></div>
<blockquote>
<p>remove ALL images</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">du</span> <span class="o">-</span><span class="n">sh</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">aufs</span>
</pre></div>
<blockquote>
<p>Summarize the amount of disk space taken by images and layers, e.g.: 72K    /var/lib/docker/aufs/</p>
</blockquote>
<p>Sometimes a docker image is <strong>still connected to a container</strong> (already exited or forgotten)</p>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
<span class="n">docker</span> <span class="n">rm</span> <span class="n">name_or_id</span>

<span class="n">docker</span> <span class="n">rm</span> <span class="n">a1b2</span>
<span class="n">docker</span> <span class="n">rmi</span> <span class="n">image_id</span>
</pre></div>
<blockquote>
<p><strong>it will "smart match" the first characters of the container ID</strong> the same as git short sha</p>
</blockquote>
<h3 id="docker-info">Docker info</h3>
<div class="highlight"><pre><span></span><span class="n">docker</span>
</pre></div>
<blockquote>
<p>get a helpful list of all the commands</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="c1">--version</span>

<span class="n">docker</span> <span class="n">info</span>

<span class="p">:::</span><span class="nb">text</span>
<span class="n">Containers</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Images</span><span class="p">:</span> <span class="mi">23</span>
<span class="k">Storage</span> <span class="n">Driver</span><span class="p">:</span> <span class="n">aufs</span>
 <span class="n">Root</span> <span class="n">Dir</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">aufs</span>
 <span class="n">Dirs</span><span class="p">:</span> <span class="mi">25</span>
<span class="n">Execution</span> <span class="n">Driver</span><span class="p">:</span> <span class="n">native</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span>
<span class="n">Kernel</span> <span class="k">Version</span><span class="p">:</span> <span class="mi">3</span><span class="p">.</span><span class="mi">13</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span><span class="mi">35</span><span class="o">-</span><span class="n">generic</span>
<span class="n">Operating</span> <span class="k">System</span><span class="p">:</span> <span class="n">Ubuntu</span> <span class="mi">14</span><span class="p">.</span><span class="mi">04</span><span class="p">.</span><span class="mi">1</span> <span class="n">LTS</span>
<span class="n">WARNING</span><span class="p">:</span> <span class="k">No</span> <span class="n">swap</span> <span class="k">limit</span> <span class="n">support</span>

<span class="n">du</span> <span class="o">-</span><span class="n">sh</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">aufs</span>
</pre></div>
<blockquote>
<p>469M    /var/lib/docker/aufs/</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">ps</span> <span class="c1">--all</span>
</pre></div>
<blockquote>
<p>no containers are running yet</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">ps</span> <span class="c1">--help</span>
</pre></div>
<p><strong>docker images --tree</strong> is a deprecated command to view the hashes and sizes of all of the parent images</p>
<hr/>
<h2 id="controlling-containers">Controlling Containers</h2>
<h3 id="starting-a-container-from-an-image">Starting a container from an image</h3>
<h4 id="create-a-container">Create a container</h4>
<p>First you must create a container from an image:</p>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span>
</pre></div>
<blockquote>
<p>get a helpful list of how to run a container</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="nv">docker</span> <span class="nv">run</span> <span class="o">--</span><span class="nv">rm</span> <span class="o">-</span><span class="nv">i</span> <span class="o">-</span><span class="nv">t</span> <span class="nv">ubuntu</span>:<span class="mi">14</span>.<span class="mi">04</span> <span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">bash</span>

:::<span class="nv">text</span>
<span class="nv">creates</span> <span class="nv">a</span> <span class="nv">container</span>
<span class="o">--</span><span class="nv">rm</span>: <span class="nv">automatically</span> <span class="nv">remove</span> <span class="nv">the</span> <span class="nv">container</span> <span class="nv">when</span> <span class="nv">it</span> <span class="nv">exits</span>
<span class="o">-</span><span class="nv">i</span>: <span class="nv">keep</span> <span class="nv">stdin</span> <span class="nv">open</span> <span class="nv">even</span> <span class="k">if</span> <span class="nv">not</span> <span class="nv">attached</span>
<span class="o">-</span><span class="nv">t</span>: <span class="nv">allocate</span> <span class="nv">a</span> <span class="nv">tty</span>, <span class="nv">attach</span> <span class="nv">stdin</span> <span class="nv">and</span> <span class="nv">stdout</span>
<span class="nv">use</span> <span class="nv">the</span> <span class="nv">ubuntu</span> <span class="mi">14</span>.<span class="mi">04</span> <span class="nv">minimal</span> <span class="nv">image</span>
<span class="nv">Docker</span> <span class="nv">automatically</span> <span class="nv">gives</span> <span class="nv">the</span> <span class="nv">container</span> <span class="nv">a</span> <span class="k">random</span> <span class="nv">name</span>
<span class="nv">Runs</span> <span class="nv">an</span> <span class="nv">interactive</span> <span class="nv">bash</span> <span class="nv">shell</span>
</pre></div>
<blockquote>
<p>This will continue to exist in a stopped state once exited (see "docker ps -a")</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">root</span><span class="nv">@f5878ed6016e</span><span class="err">:</span><span class="o">/</span><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">issue</span><span class="w"></span>
<span class="n">root</span><span class="nv">@f5878ed6016e</span><span class="err">:</span><span class="o">/</span><span class="err">#</span><span class="w"> </span><span class="n">uname</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="w"></span>
<span class="n">root</span><span class="nv">@f5878ed6016e</span><span class="err">:</span><span class="o">/</span><span class="err">#</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"></span>
</pre></div>
<p>Control-p then Control-q to detach the tty without exiting the shell</p>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">ps</span>

<span class="n">docker</span> <span class="n">run</span> <span class="c1">--detach --name myapp -p 127.0.0.1:5000:5000 training/webapp python app.py</span>
</pre></div>
<blockquote>
<p>detached with port 5000 available only to the host and executing the command python with parameter app.py</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="nv">docker</span> <span class="k">exec</span> <span class="nv">myapp</span> <span class="nv">ls</span> <span class="o">-</span><span class="nv">ahl</span>
</pre></div>
<blockquote>
<p>runs the ls command inside the container named "myapp"</p>
</blockquote>
<ul>
<li><code>docker run --rm -i -t --link myhipchat_mariadb_1 mariadb:5 /bin/bash -c "exec mysql --version"</code></li>
<li><code>docker run --rm -i -t --link myhipchat_mariadb_1:mysql mariadb:5 /bin/bash -c 'exec mysql -h"$MYSQL_PORT_3306_TCP_ADDR" -P"$MYSQL_PORT_3306_TCP_PORT" -uroot -p'</code><blockquote>
<p>an Image can contain both the server and client code so run a "client container" to connect to a running server Container </p>
</blockquote>
</li>
</ul>
<h4 id="start-resume-a-container">Start (resume) a container</h4>
<p>After a container has already been created (which starts it so ironically this is actually a "restart")</p>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="k">start</span> <span class="c1">--interactive --attach container_id_or_name</span>
</pre></div>
<h4 id="attaching-to-a-running-container">Attaching to a running container</h4>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span> 
<span class="n">CONTAINER</span> <span class="n">ID</span> <span class="p">...</span> <span class="n">STATUS</span>        <span class="k">NAMES</span>
<span class="mi">9</span><span class="n">e0ebf4421dd</span> <span class="p">...</span> <span class="n">Up</span> <span class="mi">6</span> <span class="n">seconds</span>  <span class="n">myexample</span>

<span class="n">docker</span> <span class="n">attach</span> <span class="mi">9</span><span class="n">e0ebf4421dd</span>
<span class="n">docker</span> <span class="n">attach</span> <span class="n">myexample</span>
</pre></div>
<blockquote>
<p>since the above will expect the container to have /bin/bash it will reuse the instance of shell</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="nv">sudo</span> <span class="nv">docker</span> <span class="k">exec</span> <span class="o">-</span><span class="nv">i</span> <span class="o">-</span><span class="nv">t</span> <span class="mi">9</span><span class="nv">e0ebf4421dd</span> <span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">bash</span>
# <span class="nv">ps</span> <span class="nv">aux</span>
# <span class="k">exit</span>
</pre></div>
<blockquote>
<p>instead a new /bin/bash is executed inside creating a second shell - use the exit command to not leave it around</p>
</blockquote>
<h4 id="running-a-container-with-admin-privileges">Running a container with admin privileges</h4>
<p>If your container requires elevated privileges from the host then you need to provide the extra parameter:</p>
<p><code>docker run --rm -it --cap-add SYS_NET_ADMIN alpine</code></p>
<p>Alternatively give it all extended privileges and permissions:</p>
<p><code>docker run --rm -it --privileged alpine</code></p>
<p><a href="https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities">https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities</a></p>
<h3 id="stopping-a-container">Stopping a container</h3>
<p>Part of the efficiency in docker is that containers can <strong>run in the background automatically</strong></p>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="c1">--detach --name myredis redis</span>
<span class="n">docker</span> <span class="n">ps</span>
<span class="n">docker</span> <span class="n">stop</span> <span class="n">myredis</span>
</pre></div>
<p>Another efficiency is that a docker container will only <strong>run as long as it takes to execute</strong> a command (and any <strong>changes are not forgotten</strong>)</p>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">trusty</span> <span class="n">uname</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
<blockquote>
<p>this runs the container only as long as it takes to execute the command</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">attach</span> <span class="n">f5878ed6016e</span>
</pre></div>
<p><code>Control + C</code> <em>(now we have exited the container and it will clean itself up)</em></p>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
<blockquote>
<p>spun up another container but only long enough to run the command</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">CONTAINER</span> <span class="n">ID</span> <span class="n">IMAGE</span>        <span class="n">COMMAND</span>      <span class="n">CREATED</span>      <span class="n">STATUS</span>    <span class="n">PORTS</span>         <span class="k">NAMES</span>
<span class="n">e4b436320442</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mi">14</span><span class="p">.</span><span class="mi">04</span> <span class="o">-</span><span class="n">uname</span> <span class="o">-</span><span class="n">a</span>  <span class="mi">3</span> <span class="n">minutes</span> <span class="n">ago</span>              <span class="n">elegant_engelbart</span>
</pre></div>
<h3 id="copying-a-file-out-of-a-container">Copying a file out of a container</h3>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">cp</span> <span class="o">&lt;</span><span class="n">containerId</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">file</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">within</span><span class="o">/</span><span class="n">container</span> <span class="o">/</span><span class="k">host</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">target</span>
</pre></div>
<p><a href="https://docs.docker.com/engine/reference/commandline/cp/">https://docs.docker.com/engine/reference/commandline/cp/</a></p>
<h3 id="deleting-aka-removing-a-container">Deleting aka removing a container</h3>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">rm</span> <span class="n">e4b436320442</span>
</pre></div>
<blockquote>
<p>Alternatively: <code>docker rm --force elegant_engelbart</code></p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="err">$</span><span class="p">(</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">q</span><span class="p">)</span>
</pre></div>
<blockquote>
<p>Deletes forcibly all containers (be careful!)</p>
</blockquote>
<hr/>
<h2 id="dockerfile-to-automate-building-an-image">Dockerfile to automate building an image</h2>
<p>Dockerfiles allow automating the creation docker images.</p>
<p>One advantage to Dockerfile is that each command creates a separate layer so if a specific layer fails all of the previous intermediate images can be re-used.</p>
<p>Also the version style of imagename:tag allows for chaining of upgrades of child images</p>
<p>Containers as fast, reliable, and deterministic prod/qa/dev environments can also be extended to be just an improved experimentation sandbox (for those used to SSH and using Linux as a common base OS).</p>
<div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">dockerfiles</span><span class="o">/</span><span class="n">trustyssh</span>
<span class="n">vi</span> <span class="n">dockerfiles</span><span class="o">/</span><span class="n">trustyssh</span><span class="o">/</span><span class="n">Dockerfile</span>
</pre></div>
<blockquote>
<p>one Dockerfile per directory</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">trusty</span>
<span class="n">MAINTAINER</span> <span class="n">John</span> <span class="n">Pfeiffer</span> <span class="ss">"https://bitbucket.org/johnpfeiffer"</span>

<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="k">update</span> <span class="o">-</span><span class="n">y</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">openssh</span><span class="o">-</span><span class="n">server</span> <span class="n">byobu</span>
<span class="n">RUN</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">sshd</span>
<span class="n">RUN</span> <span class="n">echo</span> <span class="s1">'root:root'</span> <span class="o">|</span> <span class="n">chpasswd</span>
<span class="n">RUN</span> <span class="n">echo</span> <span class="s1">'ubuntu:ubuntu'</span> <span class="o">|</span> <span class="n">chpasswd</span>
<span class="n">RUN</span> <span class="n">sed</span> <span class="o">-</span><span class="n">ri</span> <span class="s1">'s/^PermitRootLogin\s+.*/PermitRootLogin yes/'</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span>
<span class="n">RUN</span> <span class="n">sed</span> <span class="o">-</span><span class="n">ri</span> <span class="s1">'s/UsePAM yes/#UsePAM yes/g'</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span>
<span class="n">EXPOSE</span> <span class="mi">22</span>
<span class="n">CMD</span>    <span class="p">[</span><span class="ss">"/usr/sbin/sshd"</span><span class="p">,</span> <span class="ss">"-D"</span><span class="p">]</span>


<span class="n">docker</span> <span class="n">build</span> <span class="c1">--tag=newimagename --rm ./dockerfiles/ubuntu-trusty-ssh</span>
</pre></div>
<blockquote>
<p>Each RUN command creates an intermediate container, so make sure you use the -rm option</p>
</blockquote>
<div class="highlight"><pre><span></span>Sending build context to Docker daemon  2.56 kB
Sending build context to Docker daemon
Step 0 : FROM ubuntu:trusty
 ---&gt; 5506de2b643b
...
Removing intermediate container 135b686d82a6
Step 2 : RUN apt-get update -y
 ---&gt; Running in 7fe06a9ef41b
Ign http://archive.ubuntu.com trusty InRelease
...
</pre></div>
<p>Since each run command creates a new layer it is best practice to consolidate commands for a single logical action when possible:</p>
<div class="highlight"><pre><span></span><span class="n">RUN</span> <span class="n">echo</span> <span class="ss">"#!/bin/bash"</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="k">and</span><span class="o">-</span><span class="n">run</span><span class="p">.</span><span class="n">sh</span> <span class="o">&amp;&amp;</span> <span class="err">\</span>
  <span class="n">echo</span> <span class="ss">"cd /opt/mydata/pelican-project"</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="k">and</span><span class="o">-</span><span class="n">run</span><span class="p">.</span><span class="n">sh</span> <span class="o">&amp;&amp;</span> <span class="err">\</span>
  <span class="n">echo</span> <span class="ss">"pelican content -r &amp;"</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="k">and</span><span class="o">-</span><span class="n">run</span><span class="p">.</span><span class="n">sh</span> <span class="o">&amp;&amp;</span> <span class="err">\</span>
  <span class="n">echo</span> <span class="ss">"cd /opt/mydata/pelican-project/output"</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="k">and</span><span class="o">-</span><span class="n">run</span><span class="p">.</span><span class="n">sh</span> <span class="o">&amp;&amp;</span> <span class="err">\</span>
  <span class="n">echo</span> <span class="ss">"python -m SimpleHTTPServer"</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="k">and</span><span class="o">-</span><span class="n">run</span><span class="p">.</span><span class="n">sh</span> <span class="o">&amp;&amp;</span> <span class="err">\</span>
  <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="k">and</span><span class="o">-</span><span class="n">run</span><span class="p">.</span><span class="n">sh</span>


<span class="n">docker</span> <span class="n">history</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">utopic</span><span class="o">-</span><span class="n">pelican</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
<blockquote>
<p>view the history of hashes (which can be run by themselves) and timestamps and sizes</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">IMAGE</span>               <span class="n">CREATED</span>             <span class="n">CREATED</span> <span class="k">BY</span>                                      <span class="k">SIZE</span>
<span class="mi">39</span><span class="n">ac388d3c0d</span>        <span class="mi">37</span> <span class="n">seconds</span> <span class="n">ago</span>      <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="k">c</span> <span class="o">#</span><span class="p">(</span><span class="n">nop</span><span class="p">)</span> <span class="n">CMD</span> <span class="p">[</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">build</span><span class="o">-</span>   <span class="mi">0</span> <span class="n">B</span>
<span class="mi">218</span><span class="n">edf407f18</span>        <span class="mi">37</span> <span class="n">seconds</span> <span class="n">ago</span>      <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="k">c</span> <span class="n">echo</span> <span class="ss">"#!/bin/bash"</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="n">a</span>   <span class="mi">129</span> <span class="n">B</span>
<span class="n">d9d774d344bd</span>        <span class="mi">2</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="k">c</span> <span class="o">#</span><span class="p">(</span><span class="n">nop</span><span class="p">)</span> <span class="n">EXPOSE</span> <span class="mi">8000</span><span class="o">/</span><span class="n">tcp</span>               <span class="mi">0</span> <span class="n">B</span>
<span class="n">ae1733e0e1b9</span>        <span class="mi">2</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="k">c</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">pelican</span> <span class="n">Markdown</span> <span class="n">beaut</span>   <span class="mi">20</span><span class="p">.</span><span class="mi">64</span> <span class="n">MB</span>
<span class="mi">24561</span><span class="n">ed8052f</span>        <span class="mi">2</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="k">c</span> <span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">bootstrap</span><span class="p">.</span><span class="n">pypa</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="k">get</span>   <span class="mi">9</span><span class="p">.</span><span class="mi">826</span> <span class="n">MB</span>
<span class="mi">1878</span><span class="n">a9a052eb</span>        <span class="mi">2</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="k">c</span> <span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="k">update</span> <span class="o">&amp;&amp;</span> <span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="n">install</span>    <span class="mi">60</span><span class="p">.</span><span class="mi">85</span> <span class="n">MB</span>
<span class="mi">5</span><span class="n">e5e0e9171da</span>        <span class="mi">2</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="k">c</span> <span class="o">#</span><span class="p">(</span><span class="n">nop</span><span class="p">)</span> <span class="n">MAINTAINER</span> <span class="n">John</span> <span class="n">Pfeiffer</span> <span class="err">"</span><span class="n">h</span>   <span class="mi">0</span> <span class="n">B</span>
<span class="mi">78949</span><span class="n">b1e1cfd</span>        <span class="mi">7</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="k">c</span> <span class="o">#</span><span class="p">(</span><span class="n">nop</span><span class="p">)</span> <span class="n">CMD</span> <span class="p">[</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span><span class="p">]</span>               <span class="mi">0</span> <span class="n">B</span>
<span class="mi">21</span><span class="n">abcc4ef877</span>        <span class="mi">7</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="k">c</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">'s/^#\s*\(deb.*universe\)$/   1.895 kB</span>
<span class="s1">f552c527d701        7 weeks ago         /bin/sh -c echo '</span><span class="o">#!/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="err">'</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">polic</span>   <span class="mi">215</span> <span class="n">kB</span>
<span class="n">c4c77a6165f9</span>        <span class="mi">7</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="k">c</span> <span class="o">#</span><span class="p">(</span><span class="n">nop</span><span class="p">)</span> <span class="k">ADD</span> <span class="n">file</span><span class="p">:</span><span class="mi">24</span><span class="n">ed1895f2e500dcec</span>   <span class="mi">194</span><span class="p">.</span><span class="mi">2</span> <span class="n">MB</span>
<span class="mi">511136</span><span class="n">ea3c5a</span>        <span class="mi">22</span> <span class="n">months</span> <span class="n">ago</span>                                                       <span class="mi">0</span> <span class="n">B</span>
</pre></div>
<blockquote>
<p>experimental:
<code>docker save 49b5a7a88d5 | sudo docker-squash -t ubuntu-utopic-pelican:squash | docker load</code></p>
</blockquote>
<hr/>
<h2 id="add-a-port-to-a-container">Add a port to a container</h2>
<p><code>docker run --detach --publish 127.0.0.1:2222:22 --name johnssh trustyssh</code></p>
<blockquote>
<p>run a detached container based on the trustyssh image that binds the private container port 22 to the host port 2222 (in this case the trustyssh image from above is running sshd on port 22)</p>
</blockquote>
<p><code>docker port johnssh 22</code></p>
<blockquote>
<p>127.0.0.1:2222</p>
</blockquote>
<p><code>netstat -antp | grep 2222</code></p>
<blockquote>
<p>tcp        0      0 127.0.0.1:2222          0.0.0.0:*               LISTEN      24393/docker-proxy</p>
</blockquote>
<p><code>ssh -o StrictHostKeychecking=no -p 2222 root@127.0.0.1</code></p>
<blockquote>
<p>root@19ad0614b237:~#</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">command</th>
<th align="center">output</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>docker run --detach --publish 0.0.0.0:6379:6379 --name redis redis</code></td>
<td align="center">feeb79581810a8c182202c73d4e1c6b905960bcfc860e04285f1ae03c6a47f18</td>
</tr>
<tr>
<td align="center"><code>docker port redis</code></td>
<td align="center">6379/tcp -&gt; 0.0.0.0:6379</td>
</tr>
<tr>
<td align="center"><code>docker port redis 6379</code></td>
<td align="center">0.0.0.0:6379</td>
</tr>
<tr>
<td align="center"><code>redis-cli -h docker.example.com ping</code></td>
<td align="center">PONG</td>
</tr>
<tr>
<td align="center"><code>docker run --detach --publish-all --name redis redis</code></td>
<td align="center">ff2f6d2e04d565f11d71664bf6cf23638656d9b633e4d3c94444c81b18b807bb</td>
</tr>
<tr>
<td align="center"><code>docker port redis</code></td>
<td align="center">6379/tcp -&gt; 0.0.0.0:49153</td>
</tr>
<tr>
<td align="center"><code>docker port redis 6379</code></td>
<td align="center">0.0.0.0:49153</td>
</tr>
</tbody>
</table>
<p><code>docker run --detach -P --name johnssh trustyssh</code></p>
<blockquote>
<p>publish all EXPOSE'd ports to random ports on the host</p>
</blockquote>
<h2 id="logs-from-the-containers">Logs from the containers</h2>
<p><code>docker logs container_name</code></p>
<blockquote>
<p>view the latest logs of a specific container in stdout</p>
</blockquote>
<p><code>docker logs -f container_name</code></p>
<blockquote>
<p>tail the logs for</p>
</blockquote>
<hr/>
<h2 id="host-data-with-a-docker-container">Host data with a Docker Container</h2>
<p>Volumes are where Docker Containers can access storage (either from the Host or other Containers)</p>
<p><a href="https://docs.docker.com/userguide/dockervolumes">https://docs.docker.com/userguide/dockervolumes</a></p>
<p><code>docker run --interactive --tty --name mydata --volume /tmp/mydata:/opt/mydata trustyssh /bin/bash</code></p>
<blockquote>
<p>create an interactive container named "mydata" that maps /tmp/mydata from the host onto /opt/mydata (warning: overriding any existing!)</p>
</blockquote>
<hr/>
<h2 id="managing-or-limiting-the-resources-available-to-a-container">Managing or limiting the resources available to a Container</h2>
<p><a href="https://docs.docker.com/engine/reference/run/#runtime-constraints-on-resources">https://docs.docker.com/engine/reference/run/#runtime-constraints-on-resources</a></p>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">t</span> <span class="c1">--rm --cpuset-cpu 0 --memory 512m ubuntu:14.04 /bin/bash</span>
</pre></div>
<blockquote>
<p>the usual ubuntu trusty bash prompt but anything we run will be
pinned to cpu 0 (i.e. 25% of a 4 core system) and have
at most 512 MB of RAM and 512 MB of swap available</p>
</blockquote>
<hr/>
<h2 id="using-docker-for-a-gui-application">Using Docker for a GUI application</h2>
<p>Mostly outside of the vision of containerization (neither isolation nor performance exactly) is using Docker to run GUI applications without installing them on the Host.</p>
<p>Jessie Frazelle has done some excellent work pointing out how sharing the X11 socket from the host means lots of apps can run "without being installed" <a href="https://github.com/jfrazelle/dockerfiles">https://github.com/jfrazelle/dockerfiles</a></p>
<p>One tip she did not include was the part about XManager security, run the following if you run into an error</p>
<p><code>xhost local:root</code>
- <a href="https://www.netsarang.com/knowledgebase/xmanager/3898/xhost_and_how_to_use_it">https://www.netsarang.com/knowledgebase/xmanager/3898/xhost_and_how_to_use_it</a>
- <a href="http://www.x.org/archive/X11R6.8.0/doc/xhost.1.html">http://www.x.org/archive/X11R6.8.0/doc/xhost.1.html</a></p>
<p><code>xhost local:root; docker run --rm -v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=unix$DISPLAY --device /dev/snd jess/chromium</code>
- modify the xhost security to allow access to x windows
- ephemeral so do not save anything
- share the X11 unix socket
- bind to the current display (i.e. :0.0)
- allow sound from the Docker container</p>
<hr/>
<h2 id="saving-a-docker-container-as-a-new-image">Saving a docker container as a new image</h2>
<p><code>docker commit --help</code></p>
<h3 id="docker-commit-for-a-container-ubuntutrusty-with-git">docker commit for a container: ubuntu:trusty with git</h3>
<ol>
<li><code>docker run -i -t ubuntu:trusty /bin/bash</code></li>
<li><code>Control + p then Control + q</code> <em>(to detach the tty without exiting the shell)</em></li>
<li><code>docker ps -a</code> <em>(make a note of the ID or NAME)</em></li>
<li><code>docker attach ID_OR_NAME</code></li>
<li><code>apt-get update; apt-get install git -y</code></li>
<li><code>cd /root</code></li>
<li><code>git --version</code></li>
<li><code>git clone https://johnpfeiffer@bitbucket.org/johnpfeiffer/myrepo.git</code></li>
<li><code>exit</code></li>
<li><code>exit</code><blockquote>
<p>now the Container will have git installed, a repo cloned, and will be stopped</p>
</blockquote>
</li>
<li>docker commit container_name_here johnpfeiffer_git_repo<blockquote>
<p>4a74440186d976caeccc52f5ed2bd44269beb84d472391a7ce26ee3db8ffc1e9</p>
</blockquote>
</li>
<li>docker images</li>
</ol>
<blockquote>
<p>output</p>
</blockquote>
<div class="highlight"><pre><span></span>REPOSITORY               TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
johnpfeiffer_git_repo    latest              4a74440186d9        54 seconds ago      402 MB
ubuntu                   14.04               e54ca5efa2e9        3 weeks ago         276.5 MB
</pre></div>
<hr/>
<h2 id="misc">Misc</h2>
<h3 id="python-and-pelican-static-site-generator-on-docker-ubuntu1404">Python and Pelican static site generator on docker ubuntu:14.04</h3>
<ol>
<li><code>apt-get update; apt-get install python python-setuptools openssl wget -y</code></li>
<li><code>wget -qO- https://raw.github.com/pypa/pip/master/contrib/get-pip.py | sudo python</code></li>
<li><code>pip install pelican Markdown beautifulsoup4</code></li>
<li><code>docker run -i -t -p 127.0.0.1:8000:8000 --name john johnpfeiffer_git_repo:latest /bin/bash</code></li>
<li><code>control+p then control+q</code></li>
<li><code>docker attach john</code></li>
<li><code>cd /root/myrepo</code></li>
<li><code>pelican content  (assuming pelicanconf.py is here)</code></li>
<li><code>cd output</code></li>
<li><code>python -m SimpleHTTPServer</code></li>
<li><code>control+p then control+q</code></li>
<li><code>docker ps -a</code></li>
<li><code>http://127.0.0.1:8000</code></li>
</ol>
<hr/>
<h2 id="docker-pre-built-images-from-the-registry">Docker pre built Images from the Registry</h2>
<h3 id="redis">Redis</h3>
<p><code>docker search redis</code></p>
<blockquote>
<p>search from the CLI but NAME, DESCRIPTION, STARS, OFFICIAL will only help you if you sort of already know what you are looking for</p>
</blockquote>
<p><strong><a href="https://registry.hub.docker.com/_/redis/">https://registry.hub.docker.com/_/redis/</a></strong></p>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="c1">--detach --publish 127.0.0.1:6379:6379 --name redis redis</span>
</pre></div>
<blockquote>
<p>detached container based on the redis latest bound to the host on port 6379</p>
<p>the image already includes by default the expose port command: EXPOSE 6379...
<code>apt-get install redis-tools; redis-cli</code></p>
<p>connect from the host to the redis container to the redis interactive cli</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="c1">--link redis:db  johnssh /bin/bash</span>

<span class="n">root</span><span class="nv">@d95a758eaa6b</span><span class="err">:</span><span class="o">/</span><span class="err">#</span><span class="w"></span>
<span class="n">apt</span><span class="o">-</span><span class="k">get</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">redis</span><span class="o">-</span><span class="n">tools</span><span class="w"></span>
<span class="n">env</span><span class="w"></span>
<span class="n">redis</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="err">$</span><span class="n">DB_PORT_6379_TCP_ADDR</span><span class="w"></span>
<span class="n">ping</span><span class="w"></span>
</pre></div>
<blockquote>
<p>PONG</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="k">get</span> <span class="n">mykey</span>
</pre></div>
<blockquote>
<p>"somevalue"</p>
</blockquote>
<p><code>docker stop johnssh</code></p>
<p><code>docker start --interactive --attach johnssh</code></p>
<div class="highlight"><pre><span></span><span class="n">root</span><span class="nv">@d95a758eaa6b</span><span class="err">:</span><span class="o">/</span><span class="err">#</span><span class="w"></span>
</pre></div>
<p><strong>Environment variables are tricky</strong></p>
<p><code>sudo docker run --detach --publish 127.0.0.1:2222:22 --name johnssh trustyssh</code></p>
<blockquote>
<p>if you SSH into your container or use byobu "env" will not show you the info</p>
</blockquote>
<p><strong>From the host: </strong> <code>sudo docker inspect --format '{{ .NetworkSettings.IPAddress }}' redis</code></p>
<blockquote>
<p>172.17.0.72</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">ssh</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mi">2222</span><span class="w"> </span><span class="n">root</span><span class="nv">@localhost</span><span class="w"></span>
<span class="n">apt</span><span class="o">-</span><span class="k">get</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">redis</span><span class="o">-</span><span class="n">tools</span><span class="w"></span>
<span class="n">redis</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="mf">172.17.0.72</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">mykey</span><span class="w"></span>
</pre></div>
<p><strong> Add a route to the Host From inside a Container/Guest </strong></p>
<p>HOST:</p>
<div class="highlight"><pre><span></span><span class="nv">ip</span> <span class="nv">addr</span> <span class="k">show</span>
<span class="nv">ip</span> <span class="nv">addr</span> <span class="k">show</span> <span class="o">|</span> <span class="nv">grep</span> <span class="nv">docker0</span>
<span class="nv">ip</span> <span class="nv">addr</span> <span class="k">show</span> <span class="o">|</span> <span class="nv">grep</span> <span class="nv">docker0</span> <span class="o">|</span> <span class="nv">grep</span> <span class="nv">global</span> <span class="o">|</span> <span class="nv">awk</span> <span class="s1">'</span><span class="s">{print $2}</span><span class="s1">'</span> <span class="o">|</span> <span class="nv">cut</span> <span class="o">-</span><span class="nv">d</span> <span class="o">/</span> <span class="o">-</span><span class="nv">f1</span>
<span class="nv">HOSTIP</span><span class="o">=</span>$<span class="ss">(</span><span class="nv">ip</span> <span class="nv">addr</span> <span class="k">show</span> <span class="o">|</span> <span class="nv">grep</span> <span class="nv">docker0</span> <span class="o">|</span> <span class="nv">grep</span> <span class="nv">global</span> <span class="o">|</span> <span class="nv">awk</span> <span class="s1">'</span><span class="s">{print $2}</span><span class="s1">'</span> <span class="o">|</span> <span class="nv">cut</span> <span class="o">-</span><span class="nv">d</span> <span class="o">/</span> <span class="o">-</span><span class="nv">f1</span><span class="ss">)</span>
</pre></div>
<p><code>sudo docker run -i -t --rm --add-host=docker:${HOSTIP} python:2 /bin/bash</code></p>
<div class="highlight"><pre><span></span><span class="n">root</span><span class="mi">@1</span><span class="nl">bbe25092f19</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hosts</span>

<span class="mf">172.17.0.7</span>      <span class="mi">1</span><span class="n">bbe25092f19</span>
<span class="mf">127.0.0.1</span>       <span class="n">localhost</span>
 <span class="o">::</span><span class="mi">1</span>     <span class="n">localhost</span> <span class="n">ip6</span><span class="o">-</span><span class="n">localhost</span> <span class="n">ip6</span><span class="o">-</span><span class="n">loopback</span>
<span class="n">fe00</span><span class="o">::</span><span class="mi">0</span> <span class="n">ip6</span><span class="o">-</span><span class="n">localnet</span>
<span class="n">ff00</span><span class="o">::</span><span class="mi">0</span> <span class="n">ip6</span><span class="o">-</span><span class="n">mcastprefix</span>
<span class="n">ff02</span><span class="o">::</span><span class="mi">1</span> <span class="n">ip6</span><span class="o">-</span><span class="n">allnodes</span>
<span class="n">ff02</span><span class="o">::</span><span class="mi">2</span> <span class="n">ip6</span><span class="o">-</span><span class="n">allrouters</span>

<span class="mf">172.17.42.1</span>     <span class="n">docker</span>

<span class="n">root</span><span class="mi">@1</span><span class="nl">bbe25092f19</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="n">ping</span> <span class="n">docker</span>

<span class="n">PING</span> <span class="n">docker</span> <span class="p">(</span><span class="mf">172.17.42.1</span><span class="p">)</span><span class="o">:</span> <span class="mi">56</span> <span class="n">data</span> <span class="n">bytes</span>
<span class="mi">64</span> <span class="n">bytes</span> <span class="n">from</span> <span class="mf">172.17.42.1</span><span class="o">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.158</span> <span class="n">ms</span>
</pre></div>
<p><a href="https://docs.docker.com/engine/reference/commandline/run/">https://docs.docker.com/engine/reference/commandline/run/</a></p>
<hr/>
<h2 id="docker-compose">Docker Compose</h2>
<p>Complex real systems have multiple dependencies and following the recommended Docker pattern of "do one thing per container" means needing a way to start/orchestrate a bunch of things at once.</p>
<p>While there are some amazing open source projects (<a href="http://kubernetes.io/">http://kubernetes.io/</a> , <a href="https://mesos.apache.org/documentation/latest/docker-containerizer/">https://mesos.apache.org/documentation/latest/docker-containerizer/</a>) it is instructive to start with the simplest model provided directly from Docker, <strong><a href="https://docs.docker.com/compose/">https://docs.docker.com/compose/</a></strong></p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pip</span> <span class="n">install</span> <span class="c1">--upgrade docker-compose</span>
<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="c1">--version</span>
</pre></div>
<h3 id="apppy">app.py</h3>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">redis</span> <span class="o">=</span> <span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">'redis'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="n">redis</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s1">'hits'</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">'Hello World! I have been seen </span><span class="si">%s</span><span class="s1"> times.'</span> <span class="o">%</span> <span class="n">redis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'hits'</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">"0.0.0.0"</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
<h3 id="requirementstxt">requirements.txt</h3>
<div class="highlight"><pre><span></span><span class="n">flask</span>
<span class="n">redis</span>
</pre></div>
<h3 id="dockerfile">Dockerfile</h3>
<div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="n">python</span><span class="p">:</span><span class="mi">2</span><span class="p">.</span><span class="mi">7</span>
<span class="k">ADD</span> <span class="p">.</span> <span class="o">/</span><span class="n">code</span>
<span class="n">WORKDIR</span> <span class="o">/</span><span class="n">code</span>
<span class="n">RUN</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="p">.</span><span class="n">txt</span>
<span class="n">CMD</span> <span class="n">python</span> <span class="n">app</span><span class="p">.</span><span class="n">py</span>
</pre></div>
<h3 id="docker-composeyml">docker-compose.yml</h3>
<div class="highlight"><pre><span></span><span class="n">web</span><span class="o">:</span>
  <span class="n">build</span><span class="o">:</span> <span class="o">.</span>
  <span class="n">ports</span><span class="o">:</span>
   <span class="o">-</span> <span class="s2">"5000:5000"</span>
  <span class="n">volumes</span><span class="o">:</span>
   <span class="o">-</span> <span class="o">.:/</span><span class="n">code</span>
  <span class="n">links</span><span class="o">:</span>
   <span class="o">-</span> <span class="n">redis</span>
<span class="n">redis</span><span class="o">:</span>
  <span class="n">image</span><span class="o">:</span> <span class="n">redis</span>
</pre></div>
<ul>
<li>dependencies like redis are "linked" for network access (ordering in the file is important)</li>
<li>"web" app (which comes from the current directory Dockerfile)</li>
<li>ports: exposes ports to the host (all of these are just like the docker run CLI parameters)</li>
<li>volumes: allows live editing of app.py</li>
<li>redis comes from the public docker registry image (not a Dockerfile nor a private registry) and is using the default tag of "latest"</li>
</ul>
<h3 id="docker-compose-up">docker-compose up</h3>
<p><code>docker-compose up</code></p>
<blockquote>
<p>this will docker pull redis and build from the Dockerfile and then start them all in the correct order</p>
</blockquote>
<p><code>docker-compose ps</code></p>
<blockquote>
<p>run this command in the directory with the docker-compose.yml to see the state of the system</p>
</blockquote>
<div class="highlight"><pre><span></span>         Name                      Command             State           Ports          
-------------------------------------------------------------------------------------
composeexample_redis_1   /entrypoint.sh redis-server   Up      6379/tcp               
composeexample_web_1     /bin/sh -c python app.py      Up      0.0.0.0:5000-&gt;5000/tcp
</pre></div>
<p><code>docker ps -a</code></p>
<p><code>docker-compose stop</code></p>
<p><a href="http://localhost:5000/">http://localhost:5000/</a></p>
<blockquote>
<p>Hello World! I have been seen 2 times.</p>
</blockquote>
<p><a href="https://bitbucket.org/johnpfeiffer/docker/src">https://bitbucket.org/johnpfeiffer/docker/src</a></p>
<hr/>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="building-images-with-dockerfile">Building images with Dockerfile</h3>
<p><strong>Building images often depends on the network and DNS</strong></p>
<p>If you are using Wifi be careful as intermittent network connectivity may cause frustrating issues.</p>
<p>For DNS with docker installed onto ubuntu via apt-get, try changing to Google DNS by uncommenting in:</p>
<p><code>vi /etc/default/docker</code></p>
<p><code>sudo service docker restart</code></p>
<p><strong>Building images often depends on dependencies</strong>
look closely at error messages, i.e. make: not found and ensure that an early RUN statement has apt-get update &amp;&amp; apt-get install -y build-essential</p>
<h3 id="discovering-an-image-parent-from-history">Discovering an Image Parent from History</h3>
<p>To see all of the images in detail: <code>docker images --all --digests=true</code></p>
<div class="highlight"><pre><span></span><span class="n">python</span>      <span class="mi">2</span><span class="p">.</span><span class="mi">7</span><span class="o">-</span><span class="n">alpine</span>      <span class="n">sha256</span><span class="p">:</span><span class="mi">834</span><span class="n">b44717d3928266472066d82208241a2582ce7b3787f32abbfb0def9fb0324</span>   <span class="n">c80455665c57</span>        <span class="mi">6</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="mi">71</span><span class="p">.</span><span class="mi">49</span> <span class="n">MB</span>
<span class="n">alpine</span>      <span class="n">latest</span>          <span class="n">sha256</span><span class="p">:</span><span class="n">dfbd4a3a8ebca874ebd2474f044a0b33600d4523d03b0df76e5c5986cb02d7e8</span>   <span class="mi">88</span><span class="n">e169ea8f46</span>        <span class="mi">6</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="mi">3</span><span class="p">.</span><span class="mi">984</span> <span class="n">MB</span>
</pre></div>
<p>And then you can brute force query to see if an image has child dependencies:</p>
<p><code>for i in $(docker images -q); do docker history $i | grep -q 7fb9bd20d612 &amp;&amp; echo $i; done</code></p>
<hr/>
<h2 id="more-info">More Info</h2>
<ul>
<li>Real World example of using Docker for behind the firewall delivery: <a href="https://bitbucket.org/atlassianlabs/ac-koa-hipchat-sassy/pull-request/6/readmemd-contains-instructions-on-how-to/diff">https://bitbucket.org/atlassianlabs/ac-koa-hipchat-sassy/pull-request/6/readmemd-contains-instructions-on-how-to/diff</a></li>
<li><a href="https://github.com/wsargent/docker-cheat-sheet">https://github.com/wsargent/docker-cheat-sheet</a></li>
<li><a href="http://jpetazzo.github.io/2014/06/23/docker-ssh-considered-evil">http://jpetazzo.github.io/2014/06/23/docker-ssh-considered-evil</a></li>
</ul>
<h3 id="docker-api-and-the-docker-hub-public-registry">Docker API and the Docker Hub Public Registry</h3>
<p>Docker used to have an API endpoint at registry.hub.docker.com/v1 but in a fairly typical move for them they changed it so a lot of internet "documentation" examples are wrong.</p>
<p>Also the Docker Hub was deprecated as of 1.7 so this is the last docs on how to use it (because the service is still running or compatible)</p>
<div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">index</span><span class="p">.</span><span class="n">docker</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">_ping</span>
<span class="k">true</span>
</pre></div>
<p>It uses basic authentication and while you can use the API to sign up it may just be easier to use the web site: <a href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<div class="highlight"><pre><span></span><span class="n">curl</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="nl">username</span><span class="p">:</span><span class="n">password</span><span class="nv">@index</span><span class="p">.</span><span class="n">docker</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="w"></span>
<span class="ss">"OK"</span><span class="w"></span>
</pre></div>
<blockquote>
<p>just curl with basic auth in order to check the credentials, the trailing slash is IMPORTANT </p>
</blockquote>
<p><strong>Using a browser with the Docker REST API is often more convenient as it caches the Basic Authentication</strong></p>
<ul>
<li><a href="https://docs.docker.com/v1.7/reference/api/docker-io_api/#users">https://docs.docker.com/v1.7/reference/api/docker-io_api/#users</a></li>
<li><a href="https://docs.docker.com/v1.6/reference/api/registry_api/">https://docs.docker.com/v1.6/reference/api/registry_api/</a> (because the registry api was deprecated earlier?)</li>
</ul>
<p>To see all of the images for a given repository (it is json formatted and there will be a lot of results!)
    curl https://username:password@index.docker.io/v1/repositories/python/images</p>
<p><a href="https://docs.docker.com/v1.6/reference/api/registry_api/">https://docs.docker.com/v1.6/reference/api/registry_api/</a></p>
<p>If you <code>docker search python</code> and want to see the tags (i.e. you do not want to pull every python image ever made), then try curl with REST:</p>
<div class="highlight"><pre><span></span><span class="n">curl</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="nl">username</span><span class="p">:</span><span class="n">password</span><span class="nv">@index</span><span class="p">.</span><span class="n">docker</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">repositories</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">tags</span><span class="w"></span>

<span class="o">[</span><span class="n">{"layer": "a2db1214", "name": "latest"}, {"layer": "edb21ec7", "name": "2"}, {"layer": "82b600dd", "name": "2-alpine"}, {"layer": "6a4e9662", "name": "2-onbuild"}, {"layer": "99b38a11", "name": "2-slim"}, {"layer": "fe724fa0", "name": "2-wheezy"}, {"layer": "edb21ec7", "name": "2.7"}, {"layer": "82b600dd", "name": "2.7-alpine"}, {"layer": "6a4e9662", "name": "2.7-onbuild"}, {"layer": "99b38a11", "name": "2.7-slim"}, {"layer": "fe724fa0", "name": "2.7-wheezy"}, {"layer": "c71c2739", "name": "2.7.10"}, {"layer": "f1f35fa4", "name": "2.7.10-onbuild"}, {"layer": "843123ac", "name": "2.7.10-slim"}, {"layer": "fde41dc3", "name": "2.7.10-wheezy"}, {"layer": "edb21ec7", "name": "2.7.11"}, {"layer": "82b600dd", "name": "2.7.11-alpine"}, {"layer": "6a4e9662", "name": "2.7.11-onbuild"}, {"layer": "99b38a11", "name": "2.7.11-slim"}, {"layer": "fe724fa0", "name": "2.7.11-wheezy"}, {"layer": "a87a2288", "name": "2.7.7"}, {"layer": "481b175a", "name": "2.7.8"}, {"layer": "fbb30ed2", "name": "2.7.8-onbuild"}, {"layer": "3cf7f142", "name": "2.7.8-slim"}, {"layer": "6a873836", "name": "2.7.8-wheezy"}, {"layer": "2d0d0130", "name": "2.7.9"}, {"layer": "10948f7c", "name": "2.7.9-onbuild"}, {"layer": "e86252d0", "name": "2.7.9-slim"}, {"layer": "a11d441b", "name": "2.7.9-wheezy"}, {"layer": "a2db1214", "name": "3"}, {"layer": "bb6cd371", "name": "3-alpine"}, {"layer": "80662aa6", "name": "3-onbuild"}, {"layer": "07bfefb9", "name": "3-slim"}, {"layer": "2edf9614", "name": "3-wheezy"}, {"layer": "7575f4a5", "name": "3.2"}, {"layer": "31b273f6", "name": "3.2-onbuild"}, {"layer": "ca0a0ed6", "name": "3.2-slim"}, {"layer": "f5644650", "name": "3.2-wheezy"}, {"layer": "7575f4a5", "name": "3.2.6"}, {"layer": "31b273f6", "name": "3.2.6-onbuild"}, {"layer": "ca0a0ed6", "name": "3.2.6-slim"}, {"layer": "f5644650", "name": "3.2.6-wheezy"}, {"layer": "84717b99", "name": "3.3"}, {"layer": "4de0c1a0", "name": "3.3-alpine"}, {"layer": "e0985e72", "name": "3.3-onbuild"}, {"layer": "3c0f39af", "name": "3.3-slim"}, {"layer": "a13ad718", "name": "3.3-wheezy"}, {"layer": "e663e96e", "name": "3.3.5"}, {"layer": "79d3367e", "name": "3.3.5-onbuild"}, {"layer": "84717b99", "name": "3.3.6"}, {"layer": "4de0c1a0", "name": "3.3.6-alpine"}, {"layer": "e0985e72", "name": "3.3.6-onbuild"}, {"layer": "3c0f39af", "name": "3.3.6-slim"}, {"layer": "a13ad718", "name": "3.3.6-wheezy"}, {"layer": "c7184f4f", "name": "3.4"}, {"layer": "e6310f15", "name": "3.4-alpine"}, {"layer": "c38d9f7b", "name": "3.4-onbuild"}, {"layer": "ab9f7f65", "name": "3.4-slim"}, {"layer": "c98c4a9d", "name": "3.4-wheezy"}, {"layer": "b504e00c", "name": "3.4.1"}, {"layer": "07e5901a", "name": "3.4.1-onbuild"}, {"layer": "ec50e6a0", "name": "3.4.2"}, {"layer": "ade8543e", "name": "3.4.2-onbuild"}, {"layer": "dd1dee45", "name": "3.4.2-slim"}, {"layer": "de6911d6", "name": "3.4.2-wheezy"}, {"layer": "48bc52cc", "name": "3.4.3"}, {"layer": "bf599bc6", "name": "3.4.3-onbuild"}, {"layer": "0b92f173", "name": "3.4.3-slim"}, {"layer": "b8845e5b", "name": "3.4.3-wheezy"}, {"layer": "c7184f4f", "name": "3.4.4"}, {"layer": "e6310f15", "name": "3.4.4-alpine"}, {"layer": "c38d9f7b", "name": "3.4.4-onbuild"}, {"layer": "ab9f7f65", "name": "3.4.4-slim"}, {"layer": "c98c4a9d", "name": "3.4.4-wheezy"}, {"layer": "a2db1214", "name": "3.5"}, {"layer": "bb6cd371", "name": "3.5-alpine"}, {"layer": "80662aa6", "name": "3.5-onbuild"}, {"layer": "07bfefb9", "name": "3.5-slim"}, {"layer": "c64596cb", "name": "3.5.0"}, {"layer": "c9744d7e", "name": "3.5.0-onbuild"}, {"layer": "ac60c7d8", "name": "3.5.0-slim"}, {"layer": "31ef8f64", "name": "3.5.0b3"}, {"layer": "7c5e081c", "name": "3.5.0b3-onbuild"}, {"layer": "0c47d2de", "name": "3.5.0b3-slim"}, {"layer": "a2db1214", "name": "3.5.1"}, {"layer": "bb6cd371", "name": "3.5.1-alpine"}, {"layer": "80662aa6", "name": "3.5.1-onbuild"}, {"layer": "07bfefb9", "name": "3.5.1-slim"}, {"layer": "bb6cd371", "name": "alpine"}, {"layer": "80662aa6", "name": "onbuild"}, {"layer": "07bfefb9", "name": "slim"}, {"layer": "2edf9614", "name": "wheezy"}</span><span class="o">]</span><span class="w"></span>
</pre></div>
<h4 id="docker-engine-internal-api">Docker Engine internal API</h4>
<p>If instead of the docker client you wish to interact more programatically...</p>
<ul>
<li><a href="https://docs.docker.com/engine/reference/api/docker_remote_api/">https://docs.docker.com/engine/reference/api/docker_remote_api/</a></li>
<li><a href="https://github.com/docker/distribution">https://github.com/docker/distribution</a></li>
</ul>
<h3 id="private-docker-registry">Private Docker Registry</h3>
<h4 id="login-to-a-private-docker-registry">Login to a private docker registry</h4>
<div class="highlight"><pre><span></span><span class="n">curl</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="nl">username</span><span class="p">:</span><span class="n">password</span><span class="nv">@docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">v2</span><span class="o">/</span><span class="w"></span>
</pre></div>
<blockquote>
<p>attempt to login to a private registry</p>
</blockquote>
<p><strong> Using the docker client to login to a private registry </strong></p>
<div class="highlight"><pre><span></span><span class="n">docker</span><span class="w"> </span><span class="n">login</span><span class="w"> </span><span class="n">docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="nl">com</span><span class="p">:</span><span class="mi">443</span><span class="w"></span>
<span class="o">&gt;</span><span class="w"> </span><span class="nl">Username</span><span class="p">:</span><span class="w"> </span><span class="k">user</span><span class="nv">@example</span><span class="p">.</span><span class="n">com</span><span class="w"></span>
<span class="o">&gt;</span><span class="w"> </span><span class="nl">WARNING</span><span class="p">:</span><span class="w"> </span><span class="n">login</span><span class="w"> </span><span class="n">credentials</span><span class="w"> </span><span class="n">saved</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="k">USER</span><span class="o">/</span><span class="p">.</span><span class="n">docker</span><span class="o">/</span><span class="n">config</span><span class="p">.</span><span class="n">json</span><span class="w"></span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">Login</span><span class="w"> </span><span class="n">Succeeded</span><span class="w"></span>
</pre></div>
<h4 id="private-registry-basics-via-the-browser">private registry basics via the browser</h4>
<p>How to deploy your own docker registry: <a href="https://docs.docker.com/registry/deploying/">https://docs.docker.com/registry/deploying/</a></p>
<div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">_ping</span>
</pre></div>
<blockquote>
<p>{}</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">info</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="k">version</span>
</pre></div>
<blockquote>
<p>note these commands may not be enabled or available in your private registry version </p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">repositories</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">tags</span>
</pre></div>
<blockquote>
<p>{"13.04": "5e47ac691989afcd10285ea4e67b46bc0fdc98d90844e57a6d4221c1e3ab4388"}</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">repositories</span><span class="o">/</span><span class="n">micros</span><span class="o">/</span><span class="n">baseimage</span><span class="o">-</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">tags</span>
</pre></div>
<blockquote>
<p>{"latest": "5a14c1498ff4983793f6e5eddd16868dbad257195f0e85c66ece94d881ecb28f"}</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">repositories</span><span class="o">/</span><span class="n">micros</span><span class="o">/</span><span class="n">baseimage</span><span class="o">-</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">images</span>
</pre></div>
<blockquote>
<p>list of the images available: [{"id":"8254ff58b098b72425854555204171352a69f5427ba83dee4642ba45d301d0b1"}]</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">repositories</span><span class="o">/</span><span class="n">micros</span><span class="o">/</span><span class="n">baseimage</span><span class="o">-</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">json</span>
</pre></div>
<blockquote>
<p>inspect an image (what OS, kernel, etc.) {"arch": "amd64", "docker_go_version": "go1.3.3", "docker_version": "1.3.3", "kernel": "3.16.7-tinycore64", "last_update": 1426041024, "os": "linux"}</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">repositories</span><span class="o">/</span><span class="n">myuser</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="mi">0348</span><span class="n">bf1e7cc54327b8c9ce8407c5b3eadade1ef1771d642d08ae16a6aad5bed5</span><span class="o">/</span><span class="n">json</span>
</pre></div>
<blockquote>
<p>inspect a very specific image (by id)</p>
</blockquote>
<h4 id="searching-a-private-docker-registry">Searching a private docker registry</h4>
<div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">registry</span><span class="p">.</span><span class="n">hub</span><span class="p">.</span><span class="n">docker</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="k">search</span><span class="o">?</span><span class="n">q</span><span class="o">=</span><span class="n">pfeiffer</span>
</pre></div>
<blockquote>
<p>the public docker registry search query, deprecated in APIv2 so no longer functional</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">docker</span> <span class="k">search</span> <span class="n">docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">myuser</span>
</pre></div>
<blockquote>
<p>the cli command returns a listing of all of the images for a user, deprecated in APIv2 so no longer functional</p>
</blockquote>
<p>If there is a proxy in front: <code>docker search user:password@docker.example.com/myuser</code></p>
<div class="highlight"><pre><span></span><span class="n">curl</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="k">GET</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="k">user</span><span class="err">:</span><span class="n">password</span><span class="nv">@docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="k">search</span><span class="w"></span>
</pre></div>
<blockquote>
<p>LIST ALL IMAGES: or use a browser https://docker.example.com/v1/search</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">curl</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="k">GET</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="k">user</span><span class="err">:</span><span class="n">password</span><span class="nv">@docker</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="k">search</span><span class="vm">?</span><span class="n">q</span><span class="o">=</span><span class="n">ubuntu</span><span class="w"></span>
</pre></div>
<blockquote>
<p>https://docker.example.com/v1/search?q=ubuntu
{"num_results": 4, "query": "ubuntu", "results": [{"description": null, "name": "example/ubuntu"}, {"description": null, "name": "library/ubuntu"}, {"description": null, "name": "micros/baseimage-ubuntu-ansible"}, {"description": null, "name": "micros/baseimage-ubuntu"}]}</p>
</blockquote>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-private-docker-registry-on-ubuntu-14-04">https://www.digitalocean.com/community/tutorials/how-to-set-up-a-private-docker-registry-on-ubuntu-14-04</a></li>
</ul>
            <aside>
            <hr/>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">Â« <a href="https://blog.john-pfeiffer.com/markdown-syntax-cheatsheet/" title="Previous: Markdown syntax cheatsheet">Markdown syntax cheatsheet</a></li>
 
                <li class="next_article"><a href="https://blog.john-pfeiffer.com/using-vagrant-to-deploy-instances-on-aws/" title="Next: Using Vagrant to deploy instances on AWS">Using Vagrant to deploy instances on AWS</a> Â»</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2014-07-10T17:00:00-07:00">Jul 10, 2014</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#virtualization-ref">virtualization</a> 
            <h4>~3792 words</h4>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#containers-ref">containers
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#docker-ref">docker
                    <span>5</span>
</a></li>
            </ul>

        </div>
        </section>
</div>
</article>
				</div>
				<div class="span1"></div>
			</div>
		</div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
    </ul>
</div>
</footer>            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    </body>
</html>