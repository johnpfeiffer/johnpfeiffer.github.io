<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="john pfeiffer" />
        <meta name="copyright" content="john pfeiffer" />

<meta name="keywords" content="linux, iptables, firewall, NAT, ufw, linux, " />
        <title>firewall iptables ufw ssh https nat forwarding redirect  · johnpfeiffer
</title>
        <!--link href="https://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css"-->
        <!--link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet"-->
        <link href="https://blog.john-pfeiffer.com/theme/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://blog.john-pfeiffer.com/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://blog.john-pfeiffer.com/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="https://blog.john-pfeiffer.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="https://blog.john-pfeiffer.com/theme/images/apple-touch-icon-144x144.png" />
    </head>
    <body>
	<div id="content-sans-footer">
        <div class="dropdown-backdrop">

			<div class="navbar navbar-static-top">
				<div class="navbar-inner">
					<div class="container">
						<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</a>
						<a class="brand" href="https://blog.john-pfeiffer.com/"><span class=site-name>johnpfeiffer</span></a>
						<div class="nav-collapse collapse">
							<ul class="nav pull-right top-menu">
								<li ><a href="https://blog.john-pfeiffer.com">Home</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/engineering-people-managers/">Engineering (People) Managers</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/john-likes/">John Likes</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/software-engineer-favorites/">Software Engineer Favorites</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/categories.html">Categories</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/tags.html">Tags</a></li>
								<li ><a href="https://blog.john-pfeiffer.com/archives.html">Archives</a></li>
								<li><form class="navbar-search" action="https://blog.john-pfeiffer.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span1"></div>
				<div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="https://blog.john-pfeiffer.com/firewall-iptables-ufw-ssh-https-nat-forwarding-redirect/"> firewall iptables ufw ssh https nat forwarding redirect  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#most-common-commands">Most common commands</a></li>
<li><a href="#interactive-commands">Interactive commands</a><ul>
<li><a href="#iptables-allow-ping-with-a-ratelimit">iptables allow ping with a ratelimit</a></li>
<li><a href="#clean-out-the-old-iptables-very-insecure-settings">Clean out the old iptables - very insecure settings</a></li>
<li><a href="#allow-ssh-ping-and-established-but-block-all-by-default">Allow SSH, ping, and Established but block all by default</a></li>
<li><a href="#bash-script-to-set-iptables-during-initd">bash script to set iptables during init.d</a></li>
<li><a href="#web-server">Web Server</a></li>
<li><a href="#web-and-xmpp-server">Web and XMPP Server</a></li>
<li><a href="#ntp">NTP</a></li>
<li><a href="#nat-forwarding">NAT forwarding</a></li>
<li><a href="#cifs">CIFS</a></li>
<li><a href="#allow-ad-lookups-ldapldaps">Allow AD Lookups LDAP/LDAPS</a></li>
<li><a href="#dmz-setup-with-dual-nic">DMZ Setup with dual nic</a><ul>
<li><a href="#forward-traffic-between-dmz-and-lan">forward traffic between DMZ and LAN</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#uncomplicated-firewall-ufw">Uncomplicated Firewall UFW</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">

            
<p>iptables is the tool to create a firewall in linux (manipulate the tables provided by the kernel firewall aka the netfilter)
<a href="https://en.wikipedia.org/wiki/Netfilter">https://en.wikipedia.org/wiki/Netfilter</a></p>
<div class="highlight"><pre><span></span><code>which iptables
sudo /sbin/iptables --version
</code></pre></div>
<h2 id="most-common-commands">Most common commands</h2>
<div class="highlight"><pre><span></span><code>iptables -nvL
</code></pre></div>
<blockquote>
<p>output the rules in the default "FILTER" table (INPUT, OUTPUT) in numeric , verbose, List all rules</p>
</blockquote>
<p><a href="http://ipset.netfilter.org/iptables.man.html">http://ipset.netfilter.org/iptables.man.html</a></p>
<div class="highlight"><pre><span></span><code>iptables -nvL --line-numbers
</code></pre></div>
<blockquote>
<p>numeric so no hostname lookups, verbose, List the rules in the chain</p>
</blockquote>
<h2 id="interactive-commands">Interactive commands</h2>
<div class="highlight"><pre><span></span><code>iptables -D INPUT 5
</code></pre></div>
<blockquote>
<p>delete the 5th line</p>
</blockquote>
<p><em>don't forget chmod +x firewall-script-filename.sh and /sbin/service iptables save</em></p>
<h3 id="iptables-allow-ping-with-a-ratelimit">iptables allow ping with a ratelimit</h3>
<div class="highlight"><pre><span></span><code><span class="nx">iptables</span><span class="w"> </span><span class="o">-</span><span class="nx">A</span><span class="w"> </span><span class="nx">INPUT</span><span class="w"> </span><span class="o">-</span><span class="nx">p</span><span class="w"> </span><span class="nx">icmp</span><span class="w"> </span><span class="o">-</span><span class="nx">m</span><span class="w"> </span><span class="nx">limit</span><span class="w"> </span><span class="o">--</span><span class="nx">limit</span><span class="w"> </span><span class="mi">10</span><span class="o">/</span><span class="nx">second</span><span class="w"> </span><span class="o">-</span><span class="nx">j</span><span class="w"> </span><span class="nx">ACCEPT</span>
<span class="nx">iptables</span><span class="w"> </span><span class="o">-</span><span class="nx">A</span><span class="w"> </span><span class="nx">OUPUT</span><span class="w"> </span><span class="o">-</span><span class="nx">p</span><span class="w"> </span><span class="nx">icmp</span><span class="w"> </span><span class="o">-</span><span class="nx">j</span><span class="w"> </span><span class="nx">ACCEPT</span>
<span class="p">&gt;</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nx">inbound</span><span class="w"> </span><span class="nx">icmp</span><span class="w"> </span><span class="nx">packets</span><span class="w"> </span><span class="p">(</span><span class="k">not</span><span class="w"> </span><span class="nx">tcp</span><span class="w"> </span><span class="nx">nor</span><span class="w"> </span><span class="nx">udp</span><span class="p">)</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">second</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">icmp</span><span class="w"> </span><span class="nx">traffic</span><span class="w"> </span><span class="nx">outbound</span>

<span class="nx">iptables</span><span class="w"> </span><span class="o">-</span><span class="nx">A</span><span class="w"> </span><span class="nx">INPUT</span><span class="w"> </span><span class="o">-</span><span class="nx">p</span><span class="w"> </span><span class="nx">icmp</span><span class="w"> </span><span class="o">--</span><span class="nx">icmp</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="nx">echo</span><span class="o">-</span><span class="nx">request</span><span class="w"> </span><span class="o">-</span><span class="nx">j</span><span class="w"> </span><span class="nx">ACCEPT</span>
<span class="p">&gt;</span><span class="w"> </span><span class="nx">echo</span><span class="o">-</span><span class="nx">request</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">numeric</span>

<span class="nx">iptables</span><span class="w"> </span><span class="o">-</span><span class="nx">A</span><span class="w"> </span><span class="nx">OUTPUT</span><span class="w"> </span><span class="o">-</span><span class="nx">p</span><span class="w"> </span><span class="nx">icmp</span><span class="w"> </span><span class="o">--</span><span class="nx">icmp</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="nx">echo</span><span class="o">-</span><span class="nx">reply</span><span class="w"> </span><span class="o">-</span><span class="nx">j</span><span class="w"> </span><span class="nx">ACCEPT</span>
<span class="p">&gt;</span><span class="w"> </span><span class="nx">Allow</span><span class="w"> </span><span class="nx">outgoing</span><span class="w"> </span><span class="nx">ping</span><span class="w"> </span><span class="nx">replies</span><span class="p">,</span><span class="w"> </span><span class="nx">echo</span><span class="w"> </span><span class="nx">reply</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">numeric</span>
</code></pre></div>
<h3 id="clean-out-the-old-iptables-very-insecure-settings">Clean out the old iptables - very insecure settings</h3>
<div class="highlight"><pre><span></span><code>iptables -F
iptables --delete-chain
iptables -t nat -F
iptables -t mangle -F

iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT
</code></pre></div>
<blockquote>
<p>Flush out all of the iptables and delete all of the chains (including the nat and mangle tables)
Set the default policies to accept all packets</p>
</blockquote>
<h3 id="allow-ssh-ping-and-established-but-block-all-by-default">Allow SSH, ping, and Established but block all by default</h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>
iptables<span class="w"> </span>-I<span class="w"> </span>INPUT<span class="w"> </span><span class="m">1</span><span class="w"> </span>-i<span class="w"> </span>lo<span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-I<span class="w"> </span>OUTPUT<span class="w"> </span><span class="m">1</span><span class="w"> </span>-o<span class="w"> </span>lo<span class="w"> </span>-j<span class="w"> </span>ACCEPT
&gt;<span class="w"> </span>Always<span class="w"> </span>allow<span class="w"> </span>the<span class="w"> </span>loopback<span class="w"> </span>device

iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--sport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
&gt;<span class="w"> </span>allow<span class="w"> </span>SSH<span class="w"> </span>server<span class="w"> </span>to<span class="w"> </span>accept<span class="w"> </span>connections

iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-i<span class="w"> </span>eth1<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-o<span class="w"> </span>eth1<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--sport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
&gt;<span class="w"> </span>ssh<span class="w"> </span>server<span class="w"> </span>on<span class="w"> </span>eth1<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">22</span>

iptables<span class="w"> </span>-P<span class="w"> </span>INPUT<span class="w"> </span>DROP
iptables<span class="w"> </span>-P<span class="w"> </span>FORWARD<span class="w"> </span>DROP
iptables<span class="w"> </span>-P<span class="w"> </span>OUTPUT<span class="w"> </span>DROP
&gt;<span class="w"> </span>default<span class="w"> </span>to<span class="w"> </span>block<span class="w"> </span>all<span class="w"> </span>traffic

iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>ESTABLISHED,RELATED<span class="w"> </span>-j<span class="w"> </span>ACCEPT
&gt;<span class="w"> </span>Accept<span class="w"> </span>packets<span class="w"> </span>belonging<span class="w"> </span>to<span class="w"> </span>established<span class="w"> </span>and<span class="w"> </span>related<span class="w"> </span>connections

iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-i<span class="w"> </span>eth1<span class="w"> </span>-p<span class="w"> </span>icmp<span class="w"> </span>--icmp-type<span class="w"> </span>echo-request<span class="w"> </span>-j<span class="w"> </span>ACCEPT
&gt;<span class="w"> </span>Allow<span class="w"> </span>incoming<span class="w"> </span>ping<span class="w"> </span>requests<span class="w"> </span>from<span class="w"> </span>eth1<span class="w"> </span>,<span class="w"> </span>echo-request<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>numeric

iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-o<span class="w"> </span>eth1<span class="w"> </span>-p<span class="w"> </span>icmp<span class="w"> </span>--icmp-type<span class="w"> </span>echo-reply<span class="w"> </span>-j<span class="w"> </span>ACCEPT
&gt;<span class="w"> </span>Allow<span class="w"> </span>outgoing<span class="w"> </span>ping<span class="w"> </span>replies<span class="w"> </span>to<span class="w"> </span>eth1<span class="w"> </span>,<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">reply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>numeric
</code></pre></div>
<hr/>
<div class="highlight"><pre><span></span><code>cat /proc/sys/net/ipv4/ip_forward
echo 1 &gt; /proc/sys/net/ipv4/ip_forward
</code></pre></div>
<blockquote>
<p>enable packet forwarding by the kernel, required to enable routing (especially with dual nics)</p>
</blockquote>
<h3 id="bash-script-to-set-iptables-during-initd">bash script to set iptables during init.d</h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># script to set the initial firewall state as very restrictive</span>
<span class="c1"># chmod +x SCRIPTNAME.sh</span>
<span class="c1"># cd /etc/init.d</span>
<span class="c1"># sudo update-rc.d SCRIPTNAME.sh defaults</span>
<span class="c1"># sudo update-rc.d -f SCRIPTNAME.sh remove</span>
<span class="c1"># or add it to /etc/rc.d/rc.local (which runs once after all other scripts)</span>

<span class="c1"># clear any existing firewall</span>
iptables<span class="w"> </span>-F
iptables<span class="w"> </span>-X
iptables<span class="w"> </span>-F<span class="w"> </span>-t<span class="w"> </span>mangle
iptables<span class="w"> </span>-F<span class="w"> </span>-t<span class="w"> </span>nat
iptables<span class="w"> </span>-P<span class="w"> </span>INPUT<span class="w"> </span>DROP
iptables<span class="w"> </span>-P<span class="w"> </span>FORWARD<span class="w"> </span>DROP
iptables<span class="w"> </span>-P<span class="w"> </span>OUTPUT<span class="w"> </span>DROP

<span class="c1"># Protect against SYN flood attacks (see http://cr.yp.to/syncookies.html).</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/proc/sys/net/ipv4/tcp_syncookies

<span class="c1"># Allow loopback</span>
iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-i<span class="w"> </span>lo<span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-o<span class="w"> </span>lo<span class="w"> </span>-j<span class="w"> </span>ACCEPT

<span class="c1"># Allow DNS queries</span>
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>--dport<span class="w"> </span><span class="m">53</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>--sport<span class="w"> </span><span class="m">53</span><span class="w"> </span>--dport<span class="w"> </span><span class="m">1024</span>:65535<span class="w">  </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>ESTABLISHED<span class="w"> </span>-j<span class="w"> </span>ACCEPT

<span class="c1"># Allow NTP (query time server)</span>
iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>--dport<span class="w"> </span><span class="m">123</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>--sport<span class="w"> </span><span class="m">123</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT

<span class="c1"># Allow SSH on port 22</span>
iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW,ESTABLISHED<span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--sport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW,ESTABLISHED<span class="w"> </span>-j<span class="w"> </span>ACCEPT

<span class="c1"># Allow incoming HTTPS</span>
iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-s<span class="w"> </span><span class="m">0</span>/0<span class="w"> </span>--sport<span class="w"> </span><span class="m">1024</span>:65535<span class="w"> </span>--dport<span class="w"> </span><span class="m">443</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW,ESTABLISHED<span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-s<span class="w"> </span><span class="m">0</span>/0<span class="w"> </span>--sport<span class="w"> </span><span class="m">443</span><span class="w"> </span>--dport<span class="w"> </span><span class="m">1024</span>:65535<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>ESTABLISHED<span class="w"> </span>-j<span class="w"> </span>ACCEPT

<span class="c1"># Allow outgoing HTTPS (note state for INPUT is only ESTABLISHED)</span>
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">443</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW,ESTABLISHED<span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-s<span class="w"> </span><span class="m">0</span>/0<span class="w"> </span>--sport<span class="w"> </span><span class="m">443</span><span class="w"> </span>--dport<span class="w"> </span><span class="m">1024</span>:65535<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>ESTABLISHED<span class="w"> </span>-j<span class="w"> </span>ACCEPT
</code></pre></div>
<h3 id="web-server">Web Server</h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>
iptables<span class="w"> </span>-F
iptables<span class="w"> </span>--delete-chain
iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-F
iptables<span class="w"> </span>-t<span class="w"> </span>mangle<span class="w"> </span>-F

iptables<span class="w"> </span>-P<span class="w"> </span>INPUT<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-P<span class="w"> </span>FORWARD<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-P<span class="w"> </span>OUTPUT<span class="w"> </span>ACCEPT

<span class="c1"># LOOPBACK 127.0.0.1</span>
iptables<span class="w"> </span>-I<span class="w"> </span>INPUT<span class="w"> </span><span class="m">1</span><span class="w"> </span>-i<span class="w"> </span>lo<span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-I<span class="w"> </span>OUTPUT<span class="w"> </span><span class="m">1</span><span class="w"> </span>-o<span class="w"> </span>lo<span class="w"> </span>-j<span class="w"> </span>ACCEPT

<span class="c1"># SSH</span>
iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--sport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT

<span class="c1"># NTP</span>
iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>--dport<span class="w"> </span><span class="m">123</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>--sport<span class="w"> </span><span class="m">123</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT

<span class="c1"># DNS</span>
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>--dport<span class="w"> </span><span class="m">53</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>--sport<span class="w"> </span><span class="m">53</span><span class="w"> </span>--dport<span class="w"> </span><span class="m">1024</span>:65535<span class="w">  </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>ESTABLISHED<span class="w"> </span>-j<span class="w"> </span>ACCEPT

<span class="c1"># HTTP</span>
iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">80</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--sport<span class="w"> </span><span class="m">80</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT


<span class="c1"># DROP ALL UNDEFINED PACKETS</span>
iptables<span class="w"> </span>-P<span class="w"> </span>INPUT<span class="w"> </span>DROP
iptables<span class="w"> </span>-P<span class="w"> </span>FORWARD<span class="w"> </span>DROP
iptables<span class="w"> </span>-P<span class="w"> </span>OUTPUT<span class="w"> </span>DROP

<span class="c1"># PING</span>
<span class="c1"># iptables -A INPUT -p icmp -m limit --limit 6/second -j ACCEPT</span>
<span class="c1"># iptables -A OUPUT -p icmp -j ACCEPT</span>
</code></pre></div>
<h3 id="web-and-xmpp-server">Web and XMPP Server</h3>
<p><code>vi /etc/iptables.rules.xmpp</code></p>
<div class="highlight"><pre><span></span><code>*filter
:INPUT<span class="w"> </span>DROP<span class="w"> </span><span class="o">[</span><span class="m">3</span>:572<span class="o">]</span>
:FORWARD<span class="w"> </span>DROP<span class="w"> </span><span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
:OUTPUT<span class="w"> </span>ACCEPT<span class="w"> </span><span class="o">[</span><span class="m">10</span>:1744<span class="o">]</span>
-A<span class="w"> </span>INPUT<span class="w"> </span>-i<span class="w"> </span>lo<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span>!<span class="w"> </span>--tcp-flags<span class="w"> </span>FIN,SYN,RST,ACK<span class="w"> </span>SYN<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>DROP
-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>RELATED,ESTABLISHED<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">80</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>-m<span class="w"> </span>udp<span class="w"> </span>--dport<span class="w"> </span><span class="m">161</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">443</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">5222</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">5223</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>-m<span class="w"> </span>udp<span class="w"> </span>--dport<span class="w"> </span><span class="m">137</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>-m<span class="w"> </span>udp<span class="w"> </span>--dport<span class="w"> </span><span class="m">138</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>icmp<span class="w"> </span>-m<span class="w"> </span>icmp<span class="w"> </span>--icmp-type<span class="w"> </span><span class="m">8</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>icmp<span class="w"> </span>-m<span class="w"> </span>icmp<span class="w"> </span>--icmp-type<span class="w"> </span><span class="m">11</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>OUTPUT<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>RELATED,ESTABLISHED<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>OUTPUT<span class="w"> </span>-o<span class="w"> </span>lo<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>-m<span class="w"> </span>udp<span class="w"> </span>--dport<span class="w"> </span><span class="m">53</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>-m<span class="w"> </span>udp<span class="w"> </span>--sport<span class="w"> </span><span class="m">161</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>ACCEPT
-A<span class="w"> </span>OUTPUT<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-j<span class="w"> </span>LOG
COMMIT
</code></pre></div>
<p><code>iptables-restore &lt; /etc/iptables.rules.xmpp</code></p>
<hr/>
<h3 id="ntp">NTP</h3>
<p><em>Getting the time and date synchronized through a restricted firewall</em></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># ntpdate port 123</span>
iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>--dport<span class="w"> </span><span class="m">123</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>--sport<span class="w"> </span><span class="m">123</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT

<span class="c1"># variation where rules are inserted as first items in the Tables</span>
<span class="c1"># iptables -I INPUT 1 -p udp --dport 123 -j ACCEPT</span>
<span class="c1"># iptables -I OUTPUT 1 -p udp --sport 123 -j ACCEPT</span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p>Installing NTP...</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="nv">sudo</span><span class="w"> </span><span class="nv">apt</span><span class="o">-</span><span class="nv">get</span><span class="w"> </span><span class="nv">install</span><span class="w"> </span><span class="nv">ntp</span>
<span class="nv">nano</span><span class="w"> </span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ntp</span>.<span class="nv">conf</span>
<span class="nv">server</span><span class="w"> </span><span class="nv">ntp</span>.<span class="nv">ubuntu</span>.<span class="nv">com</span>
<span class="nv">server</span><span class="w"> </span><span class="nv">pool</span>.<span class="nv">ntp</span>.<span class="nv">org</span>

<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">ntp</span><span class="w"> </span><span class="nv">restart</span>
<span class="nv">ls</span><span class="w"> </span><span class="o">-</span><span class="nv">ahl</span><span class="w"> </span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">cron</span>.<span class="nv">daily</span><span class="w">   </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">verify</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">ntp</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="o">+</span><span class="nv">x</span><span class="w"> </span><span class="nv">executable</span>
<span class="nv">ntpq</span><span class="w"> </span><span class="o">-</span><span class="nv">p</span><span class="w">                   </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">verify</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">service</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">working</span>

<span class="o">&gt;</span><span class="w"> </span><span class="nv">MANUAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ntpdate</span><span class="w"> </span><span class="nv">pool</span>.<span class="nv">ntp</span>.<span class="nv">org</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">now</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">socket</span><span class="w"> </span><span class="mi">123</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">use</span>
</code></pre></div>
<hr/>
<h3 id="nat-forwarding">NAT forwarding</h3>
<div class="highlight"><pre><span></span><code>iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT
iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
</code></pre></div>
<blockquote>
<p>assuming that eth0 is your WAN and eth1 is your LAN</p>
<p>accept all forwarding from eth1 to eth0 and back</p>
<p>enable "nat" so that packets are addressed properly</p>
</blockquote>
<hr/>
<h3 id="cifs">CIFS</h3>
<div class="highlight"><pre><span></span><code><span class="nx">iptables</span><span class="w"> </span><span class="o">-</span><span class="nx">A</span><span class="w"> </span><span class="nx">INPUT</span><span class="w"> </span><span class="o">-</span><span class="nx">p</span><span class="w"> </span><span class="nx">tcp</span><span class="w"> </span><span class="o">-</span><span class="nx">s</span><span class="w"> </span><span class="m m-Double">10.10.10.250</span><span class="w"> </span><span class="o">--</span><span class="nx">sport</span><span class="w"> </span><span class="mi">445</span><span class="w"> </span><span class="o">-</span><span class="nx">d</span><span class="w"> </span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="nx">j</span><span class="w"> </span><span class="nx">ACCEPT</span>
<span class="nx">iptables</span><span class="w"> </span><span class="o">-</span><span class="nx">A</span><span class="w"> </span><span class="nx">OUTPUT</span><span class="w"> </span><span class="o">-</span><span class="nx">p</span><span class="w"> </span><span class="nx">tcp</span><span class="w"> </span><span class="o">-</span><span class="nx">s</span><span class="w"> </span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="o">--</span><span class="nx">sport</span><span class="w"> </span><span class="mi">1024</span><span class="p">:</span><span class="mi">65535</span><span class="w"> </span><span class="o">-</span><span class="nx">d</span><span class="w"> </span><span class="m m-Double">10.10.10.250</span><span class="w"> </span><span class="o">--</span><span class="nx">dport</span><span class="w"> </span><span class="mi">445</span><span class="w"> </span><span class="o">-</span><span class="nx">m</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">--</span><span class="nx">state</span><span class="w"> </span><span class="nx">NEW</span><span class="p">,</span><span class="nx">ESTABLISHED</span><span class="w"> </span><span class="o">-</span><span class="nx">j</span><span class="w"> </span><span class="nx">ACCEPT</span>
<span class="p">&gt;</span><span class="w"> </span><span class="nx">CIFS</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">been</span><span class="w"> </span><span class="nx">simplified</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">just</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="mi">445</span><span class="w"> </span><span class="nx">TCP</span><span class="w"> </span><span class="nx">first</span><span class="o">...</span>

<span class="nx">netbios</span><span class="o">-</span><span class="nx">ns</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">137</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">NETBIOS</span><span class="w"> </span><span class="nx">Name</span><span class="w"> </span><span class="nx">Service</span>
<span class="nx">netbios</span><span class="o">-</span><span class="nx">dgm</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">138</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">NETBIOS</span><span class="w"> </span><span class="nx">Datagram</span><span class="w"> </span><span class="nx">Service</span>
<span class="nx">netbios</span><span class="o">-</span><span class="nx">ssn</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">139</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">NETBIOS</span><span class="w"> </span><span class="nx">session</span><span class="w"> </span><span class="nx">service</span>
<span class="nx">microsoft</span><span class="o">-</span><span class="nx">ds</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">445</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">Active</span><span class="w"> </span><span class="nx">Directory</span>
</code></pre></div>
<h3 id="allow-ad-lookups-ldapldaps">Allow AD Lookups LDAP/LDAPS</h3>
<div class="highlight"><pre><span></span><code>iptables -A INPUT -p tcp -s 0/0 --sport 1024:65535 --dport 389 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp -s 0/0 --sport 389 --dport 1024:65535 -m state --state ESTABLISHED -j ACCEPT

iptables -A OUTPUT -p tcp --dport 389 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -p tcp -s 0/0 --sport 389 --dport 1024:65535 -m state --state ESTABLISHED -j ACCEPT

iptables -A INPUT -p tcp -s 0/0 --sport 1024:65535 --dport 636 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp -s 0/0 --sport 636 --dport 1024:65535 -m state --state ESTABLISHED -j ACCEPT

iptables -A OUTPUT -p tcp --dport 636 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -p tcp -s 0/0 --sport 636 --dport 1024:65535 -m state --state ESTABLISHED -j ACCEPT
</code></pre></div>
<hr/>
<h3 id="dmz-setup-with-dual-nic">DMZ Setup with dual nic</h3>
<ul>
<li>ATMOS = 10.10.254.195</li>
<li>LAN (router?) =  10.10.254.1</li>
<li>eth0 = LAN  10.10.254.254</li>
<li>eth1 = WAN 172.16.255.254</li>
<li>eth2 = DMZ  192.168.50.1</li>
<li>Router 172.16.255.1</li>
</ul>
<h4 id="forward-traffic-between-dmz-and-lan">forward traffic between DMZ and LAN</h4>
<div class="highlight"><pre><span></span><code>iptables -A FORWARD -i eth0 -o eth2 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -i eth2 -o eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT
</code></pre></div>
<blockquote>
<p>forward traffic between DMZ and WAN servers SMTP, Mail etc</p>
</blockquote>
<div class="highlight"><pre><span></span><code>iptables -A FORWARD -i eth2 -o eth1 -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -i eth1 -o eth2 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
</code></pre></div>
<blockquote>
<p>Route incoming SMTP (port 25 ) traffic to DMZ server 192.168.2.2
    iptables -t nat -A PREROUTING -p tcp -i eth1 -d 202.54.1.1 --dport 25 -j DNAT --to-destination 192.168.2.2</p>
<p>Route incoming HTTP (port 80 ) traffic to DMZ server load balancer IP 192.168.2.3
    iptables -t nat -A PREROUTING -p tcp -i eth1 -d 202.54.1.1 --dport 80 -j DNAT --to-destination 192.168.2.3</p>
<p>Route incoming HTTPS (port 443 ) traffic to DMZ server reverse load balancer IP 192.168.2.4
    iptables -t nat -A PREROUTING -p tcp -i eth1 -d 202.54.1.1 --dport 443 -j DNAT --to-destination 192.168.2.4</p>
<p>End DMZ .. Add other rules</p>
</blockquote>
<h2 id="uncomplicated-firewall-ufw">Uncomplicated Firewall UFW</h2>
<p>The uncomplicated firewall is a much simpler way to configure some basic rules and enable the firewall</p>
<div class="highlight"><pre><span></span><code>sudo su
ufw status verbose
ufw allow 22
ufw allow 443
ufw default deny incoming
ufw default deny outgoing
ufw enable
ufw status verbose
</code></pre></div>
<blockquote>
<p>Allowing 22 (SSH) and 443 (HTTPS) and denying all other incoming and outgoing traffic</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="nv">ufw</span><span class="w"> </span><span class="nv">delete</span><span class="w"> </span><span class="nv">allow</span><span class="w"> </span><span class="mi">443</span>
<span class="nv">ufw</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="nv">raw</span>
<span class="nv">ufw</span><span class="w"> </span><span class="nv">disable</span>
</code></pre></div>
<blockquote>
<p>removing a rule is as simple as prefixing the allow or deny command with delete
disabling the firewall allows all traffic</p>
</blockquote>
<p>Most unfortunately there are some basic gaps that make it not very production ready (i.e. if you know what you are doing just keep using iptables)
1. ping, also known as icmp, packets (even just outbound) have to be handled in a very complex way, really not much better than iptables
1. established connection traffic is not just easily allowed
1. attempting to do something more complex very quickly requires very complex commands including just using iptables (lolwut)
1. iptables -nvL becomes almost unreadable with the extra layer</p>
<p><a href="https://wiki.ubuntu.com/UncomplicatedFirewall">https://wiki.ubuntu.com/UncomplicatedFirewall</a></p>
            <aside>
            <hr/>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="https://blog.john-pfeiffer.com/seo-search-engine-optimization-by-john-pfeiffer/" title="Previous: SEO Search Engine Optimization by John Pfeiffer">SEO Search Engine Optimization by John Pfeiffer</a></li>
 
                <li class="next_article"><a href="https://blog.john-pfeiffer.com/network-ifconfig-ifcfg-static-and-dhcp-eth0-route-wifi-wpa/" title="Next: Network ifconfig ifcfg static and dhcp eth0 route wifi wpa">Network ifconfig ifcfg static and dhcp eth0 route wifi wpa</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2009-01-01T00:00:00-08:00">Jan 1, 2009</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#linux-ref">linux</a> 
            <h4>~1799 words</h4>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#firewall-ref">firewall
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#iptables-ref">iptables
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#linux-ref">linux
                    <span>11</span>
</a></li>
                <li><a href="/tags.html#NAT-ref">NAT
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#ufw-ref">ufw
                    <span>1</span>
</a></li>
            </ul>

        </div>
        </section>
</div>
</article>
				</div>
				<div class="span1"></div>
			</div>
		</div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
    </ul>
</div>
</footer>            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    </body>
</html>